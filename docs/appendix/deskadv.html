<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Deskadv.ksy - WebFun</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../open-in.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../related-projects.html"><strong aria-hidden="true">2.</strong> Related Projects</a></li><li class="chapter-item expanded "><a href="../architecture/index.html"><strong aria-hidden="true">3.</strong> Project Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/getting-started.html"><strong aria-hidden="true">3.1.</strong> Getting Started</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> Code</div></li><li class="chapter-item expanded "><a href="../architecture/build-system.html"><strong aria-hidden="true">3.3.</strong> Build System</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.4.</strong> Project Layout</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.5.</strong> Modules</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.6.</strong> Testing</div></li><li class="chapter-item expanded "><a href="../architecture/documentation.html"><strong aria-hidden="true">3.7.</strong> Documentation</a></li><li class="chapter-item expanded "><a href="../architecture/deployment.html"><strong aria-hidden="true">3.8.</strong> Deployment</a></li></ol></li><li class="chapter-item expanded "><a href="../gameplay/index.html"><strong aria-hidden="true">4.</strong> Gameplay</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../gameplay/main-window.html"><strong aria-hidden="true">4.1.</strong> Main Window</a></li><li class="chapter-item expanded "><a href="../gameplay/color-palette.html"><strong aria-hidden="true">4.2.</strong> Color Palette</a></li><li class="chapter-item expanded "><a href="../gameplay/tiles.html"><strong aria-hidden="true">4.3.</strong> Tiles</a></li><li class="chapter-item expanded "><a href="../gameplay/zones.html"><strong aria-hidden="true">4.4.</strong> Zones</a></li><li class="chapter-item expanded "><a href="../scripting/index.html"><strong aria-hidden="true">4.5.</strong> Scripting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../scripting/conditions.html"><strong aria-hidden="true">4.5.1.</strong> Conditions</a></li><li class="chapter-item expanded "><a href="../scripting/instructions.html"><strong aria-hidden="true">4.5.2.</strong> Instructions</a></li></ol></li><li class="chapter-item expanded "><a href="../gameplay/score.html"><strong aria-hidden="true">4.6.</strong> Score</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.7.</strong> Settings</div></li><li class="chapter-item expanded "><a href="../gameplay/map-screen.html"><strong aria-hidden="true">4.8.</strong> Map Screen</a></li><li class="chapter-item expanded "><a href="../gameplay/r2d2-help.html"><strong aria-hidden="true">4.9.</strong> R2D2 Help</a></li><li class="chapter-item expanded "><a href="../gameplay/cheats.html"><strong aria-hidden="true">4.10.</strong> Cheats</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.11.</strong> Debug Mode</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> World Generation</div></li><li class="chapter-item expanded "><a href="../files/index.html"><strong aria-hidden="true">6.</strong> Files</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> DTA / DAW</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Save Games</div></li><li class="chapter-item expanded "><a href="../files/yodesk-ini.html"><strong aria-hidden="true">6.3.</strong> Yodesk.ini</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.4.</strong> Strings</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Indy's Desktop Adventures</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> The Demo</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> The Patch</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Yoda Stories</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../yoda/releases.html"><strong aria-hidden="true">8.1.</strong> Releases</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.2.</strong> The Demo</div></li><li class="chapter-item expanded "><a href="../yoda/patch/index.html"><strong aria-hidden="true">8.3.</strong> The Patch</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../yoda/patch/zone-072.html"><strong aria-hidden="true">8.3.1.</strong> Zone 72</a></li><li class="chapter-item expanded "><a href="../yoda/patch/zone-236.html"><strong aria-hidden="true">8.3.2.</strong> Zone 236</a></li><li class="chapter-item expanded "><a href="../yoda/patch/zone-407.html"><strong aria-hidden="true">8.3.3.</strong> Zone 407</a></li><li class="chapter-item expanded "><a href="../yoda/patch/zone-474.html"><strong aria-hidden="true">8.3.4.</strong> Zone 474</a></li><li class="chapter-item expanded "><a href="../yoda/patch/zone-572.html"><strong aria-hidden="true">8.3.5.</strong> Zone 572</a></li></ol></li><li class="chapter-item expanded "><a href="../yoda/trivia.html"><strong aria-hidden="true">8.4.</strong> Trivia</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../appendix/yodesk.html">Yodesk.ksy</a></li><li class="chapter-item expanded affix "><a href="../appendix/deskadv.html" class="active">Deskadv.ksy</a></li><li class="chapter-item expanded affix "><a href="../appendix/yodasav.html">Yodasav.ksy</a></li><li class="chapter-item expanded affix "><a href="../appendix/list-of-game-files.html">List of game files</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">WebFun</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/cyco/webfun/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="deskadvksy"><a class="header" href="#deskadvksy">Deskadv.ksy</a></h1>
<p>This is a machine-readable definition of the file format used by <em>Indiana Jones and His Desktop Adventures</em>. It can be used to generate a parser or inspect files online in the <a href="https://ide.kaitai.io">Kaitai Web IDE</a>.</p>
<pre><code class="language-yaml">meta:
  id: deskadv
  application: &quot;Indiana Jones and His Desktop Adventures&quot;
  file-extension: daw
  license: CC0-1.0
  ks-version: 0.9
  endian: le
  encoding: ISO-8859-2

seq:
  - id: catalog
    type: catalog_entry
    repeat: until
    repeat-until: _.type == &quot;ENDF&quot;

types:
  catalog_entry:
    seq:
      - id: type
        type: str
        size: 4
      - id: size
        type: u4
        if: type != &quot;VERS&quot;
      - id: content
        type:
          switch-on: type
          cases:
             '&quot;VERS&quot;': version
             '&quot;STUP&quot;': startup_image
             '&quot;CHAR&quot;': characters
             '&quot;CAUX&quot;': character_auxiliaries
             '&quot;CHWP&quot;': character_weapons
             '&quot;PUZ2&quot;': puzzles
             '&quot;SNDS&quot;': sounds
             '&quot;TILE&quot;': tiles
             '&quot;TNAM&quot;': tile_names
             '&quot;ANAM&quot;': action_names
             '&quot;PNAM&quot;': puzzle_names
             '&quot;ZNAM&quot;': zone_names
             '&quot;HTSP&quot;': hotspots
             '&quot;ACTN&quot;': actions
             '&quot;ZONE&quot;': zones
             '&quot;ZAUX&quot;': zones_aux_1
             '&quot;ZAX2&quot;': zones_aux_2
             '&quot;ZAX3&quot;': zones_aux_3
             '&quot;ZAX4&quot;': zones_aux_4
             '&quot;TGEN&quot;': tgen
             '&quot;ENDF&quot;': endf
             _: unknown_catalog_entry

  unknown_catalog_entry:
    seq:
      - id: data
        size: _parent.size
  version:
    seq:
      - id: version
        doc: Version of the file. This value is always set to 512.
        type: u4
  startup_image:
    doc: |
      A 288x288 bitmap to be shown while other assets are loaded and a new
      world is generated.
    seq:
      - id: pixels
        size: _parent.size
  sounds:
    doc: |
      This section declares sounds used in the game. The actual audio data is
      stored in wav files on the disk (in a directory named `sfx`) so this
      section contains paths to each sound file.
      Sounds can be referenced from the scripting language (see `play_sound`
      instruction opcode below) and from weapon (see `character` structure).
      Some sound ids (like the one when the hero is hit, or can't leave a
      zone) are hard coded in the game.
    seq:
      - id: count
        type: s2
      - id: sounds
        type: prefixed_strz
        repeat: expr
        repeat-expr: -count
  tile_names:
    seq:
      - id: names
        doc: |
          List of tile ids and their corresponding names. These are shown in
          the inventory or used in dialogs (see `speak_hero` and `speak_npc`
          opcodes).
        type: tile_name
        repeat: until
        repeat-until:  _.tile_id == 0xFF_FF
  tile_name:
    seq:
      - id: tile_id
        type: u2
      - id: name
        type: strz
        size: 0x10
        if: tile_id != 0xFF_FF
  tiles:
    seq:
      - id: tiles
        type: tiles_entries
        size: _parent.size
  tiles_entries:
    seq:
      - id: tiles
        type: tile
        repeat: eos
  tile:
      seq:
        - id: attributes
          type: tile_attributes
          size: 4
        - id: pixels
          size: 32 * 32
  tile_attributes:
      meta:
        bit-endian: le
      seq:
        - id: has_transparency
          type: b1
          doc: |
            Affects how tile image should be drawn. If set, the
            value 0 in `pixels` is treated as transparent. Otherwise
            it is drawn as black.
        - id: is_floor
          type: b1
          doc: |
            Tile is usually placed on the lowest layer of a zone
        - id: is_object
          type: b1
          doc: |
            Object, tile is usually placed on the middle layer of a zone
        - id: is_draggable
          type: b1
          doc: |
             If set and the tile is placed on the object layer it can be
             dragged and pushed around by the hero.
        - id: is_roof
          type: b1
          doc: |
             Tile is usually placed on the top layer (roof)
        - id: is_locator
          type: b1
          doc: |
             Locator, tile is used in world map view overview
        - id: is_weapon
          type: b1
          doc: |
             Identifies tiles that are mapped to weapons
        - id: is_item
          type: b1
        - id: is_character
          type: b1
          doc: |
            Tile forms part of a character
        - id: unused
          type: b7
        # Floor flags
        - id: is_doorway
          type: b1
          doc: |
            These tiles are doorways, monsters can't go
          if: is_floor
        # Locator flags
        - id: unused1
          type: b1
          if: is_locator
        - id: is_town
          type: b1
          doc: |
            Marks the spaceport on the map
          if: is_locator
        - id: is_unsolved_puzzle
          type: b1
          doc: |
            Marks a discovered, but unsolved puzzle on the map
          if: is_locator
        - id: is_solved_puzzle
          type: b1
          doc: |
            Marks a solved puzzle on the map
          if: is_locator
        - id: is_unsolved_travel
          type: b1
          doc: |
            Marks a place of travel on the map that has not been solved
          if: is_locator
        - id: is_solved_travel
          type: b1
          doc: |
            Marks a solved place of travel on the map
          if: is_locator
        - id: is_unsolved_blockade_north
          type: b1
          doc: |
            Marks a sector on the map that blocks access to northern zones
          if: is_locator
        - id: is_unsolved_blockade_south
          type: b1
          doc: |
            Marks a sector on the map that blocks access to southern zones
          if: is_locator
        - id: is_unsolved_blockade_west
          type: b1
          doc: |
            Marks a sector on the map that blocks access to western zones
          if: is_locator
        - id: is_unsolved_blockade_east
          type: b1
          doc: |
            Marks a sector on the map that blocks access to eastern zones
          if: is_locator
        - id: is_solved_blockade_north
          type: b1
          doc: |
            Marks a solved sector on the map that used to block access to
            northern zones
          if: is_locator
        - id: is_solved_blockade_south
          type: b1
          doc: |
            Marks a solved sector on the map that used to block access to
            southern zones
          if: is_locator
        - id: is_solved_blockade_west
          type: b1
          doc: |
            Marks a solved sector on the map that used to block access to
            western zones
          if: is_locator
        - id: is_solved_blockade_east
          type: b1
          doc: |
            Marks a solved sector on the map that used to block access to
            eastern zones
          if: is_locator
        - id: is_unsolved_goal
          type: b1
          doc: |
            The final puzzle of the world. Solving this wins the game
          if: is_locator
        - id: is_location_indicator
          type: b1
          doc: |
            Overlay to mark the current position on the map
          if: is_locator
        # Item flags
        - id: is_keycard
          type: b1
          if: is_item
        - id: is_tool
          type: b1
          if: is_item
        - id: is_part
          type: b1
          if: is_item
        - id: is_valuable
          type: b1
          if: is_item
        - id: is_map
          type: b1
          if: is_item
        - id: unused2
          type: b1
          if: is_item
        - id: is_edible
          type: b1
          if: is_item
        # Weapon flags
        - id: is_low_blaster
          type: b1
          doc: |
            Item is a low intensity blaster (like the blaster pistol)
          if: is_weapon
        - id: is_high_blaster
          type: b1
          doc: |
            Item is a high intensity blaster (like the blaster rifle)
          if: is_weapon
        - id: is_lightsaber
          type: b1
          if: is_weapon
        - id: is_the_force
          type: b1
          if: is_weapon
        # Character flags
        - id: is_hero
          type: b1
          if: is_character
        - id: is_enemy
          type: b1
          if: is_character
        - id: is_npc
          type: b1
          if: is_character
  action:
    doc: |
      Actions are the game's way to make static tile based maps more engaging
      and interactive. Each action consists of zero or more conditions and
      instructions, once all conditions are satisfied, all instructions are
      executed in order.

      To facilitate state, each zone has three 16-bit registers. These registers
      are named `counter`, `shared-counter` and `random`. In addition to these
      registers hidden tiles are sometimes used to mark state.
      There are conditions and instructions to query and update these registers.
      The `shared-counter` register is special in that it is shared between a
      zone and it's rooms. Instruction `0xc` roll_dice can be used to set the
      `random` register to a random value.

      A naive implementation of the scripting engine could look like this:

      ```
      for action in zone.actions:
        all_conditions_satisfied = False
        for condition in action.conditions:
            all_conditions_satisfied = check(condition)
            if !all_conditions_satisfied:
              break

        if !all_conditions_satisfied:
          continue

        for instruction in action.instructions:
          execute(instruction)
      ```

      See `condition_opcode` and `instruction_opcode` enums for a list of
      available opcodes and their meanings.
    seq:
      - id: marker
        contents: &quot;IACT&quot;
      - id: size
        type: u4
      - id: num_conditions
        type: u2
      - id: conditions
        type: condition
        repeat: expr
        repeat-expr: num_conditions
      - id: num_instructions
        type: u2
      - id: instructions
        type: instruction
        repeat: expr
        repeat-expr: num_instructions
  condition:
    seq:
      - id: opcode
        type: u2
        enum: condition_opcode
      - id: arguments
        type: s2
        repeat: expr
        repeat-expr: 5
      - id: len_text
        type: u2
      - id: text
        type: str
        size: len_text
        doc: |
          The `text_attribute` is never used, but seems to be included to
          shared the type with instructions.
    enums:
      condition_opcode:
        0x0:
          id:  zone_not_initialised
          doc: Evaluates to true exactly once (used for initialisation)
        0x1:
          id:  zone_entered
          doc: Evaluates to true if hero just entered the zone
        0x2:
          id:  bump
        0x3:
          id:  placed_item_is
        0x4:
          id:  standing_on
          doc: |
            Check if hero is at `args[0]`x`args[1]` and the floor tile is
            `args[2]`
        0x5:
          id:  counter_is
          doc: Current zone's `counter` value is equal to `args[0]`
        0x6:
          id:  random_is
          doc: Current zone's `random` value is equal to `args[0]`
        0x7:
          id:  random_is_greater_than
          doc: Current zone's `random` value is greater than `args[0]`
        0x8:
          id:  random_is_less_than
          doc: Current zone's `random` value is less than `args[0]`
        0x9:
          id:  enter_by_plane
        0xa:
          id:  tile_at_is
          doc: |
            Check if tile at `args[0]`x`args[1]`x`args[2]` is equal to
            `args[3]`
        0xb:
          id:  monster_is_dead
          doc: True if monster `args[0]` is dead.
        0xc:
          id:  has_no_active_monsters
          doc: undefined
        0xd:
          id:  has_item
          doc: |
            True if inventory contains `args[0]`.  If `args[0]` is `0xFFFF`
            check if inventory contains the item provided by the current
            zone's puzzle
        0xe:
          id:  required_item_is
        0xf:
          id:  ending_is
          doc: True if `args[0]` is equal to current goal item id
        0x10:
          id:  zone_is_solved
          doc: True if the current zone is solved
        0x11:
          id:  no_item_placed
          doc: Returns true if the user did not place an item
        0x12:
          id:  item_placed
          doc: Returns true if the user placed an item
        0x13:
          id:  health_is_less_than
          doc: Hero's health is less than `args[0]`.
        0x14:
          id:  health_is_greater_than
          doc: Hero's health is greater than `args[0]`.
        0x15: unused
        0x16:
          id:  find_item_is
          doc: True the item provided by current zone is `args[0]`
        0x17:
          id:  placed_item_is_not
        0x18:
          id:  hero_is_at
          doc: True if hero's x/y position is `args_0`x`args_1`.
        0x19:
          id:  shared_counter_is
          doc: Current zone's `shared_counter` value is equal to `args[0]`
        0x1a:
          id:  shared_counter_is_less_than
          doc: Current zone's `shared_counter` value is less than `args[0]`
        0x1b:
          id:  shared_counter_is_greater_than
          doc: Current zone's `shared_counter` value is greater than `args[0]`
        0x1c:
          id:  games_won_is
          doc: Total games won is equal to `args[0]`
        0x1d:
          id:  drops_quest_item_at
        0x1e:
          id:  has_any_required_item
          doc: |
            Determines if inventory contains any of the required items needed
            for current zone
        0x1f:
          id:  counter_is_not
          doc: Current zone's `counter` value is not equal to `args[0]`
        0x20:
          id:  random_is_not
          doc: Current zone's `random` value is not equal to `args[0]`
        0x21:
          id:  shared_counter_is_not
          doc: Current zone's `shared_counter` value is not equal to `args[0]`
        0x22:
          id:  is_variable
          doc: |
            Check if variable identified by `args[0]`⊕`args[1]`⊕`args[2]` is
            set to `args[3]`. Internally this is implemented as opcode 0x0a,
            check if tile at `args[0]`x`args[1]`x`args[2]` is equal to
            `args[3]`
        0x23:
          id:  games_won_is_greater_than
          doc: True, if total games won is greater than `args[0]`

  instruction:
    seq:
      - id: opcode
        type: u2
        enum: instruction_opcode
      - id: arguments
        type: s2
        repeat: expr
        repeat-expr: 5
      - id: len_text
        type: u2
      - id: text
        type: str
        size: len_text
    enums:
      instruction_opcode:
        0x0:
          id:  place_tile
          doc: |
            Place tile `args[3]` at `args[0]`x`args[1]`x`args[2]`. To remove a
            tile `args[3]` can be set to `0xFFFF`.
        0x1:
          id:  remove_tile
          doc: Remove tile at `args[0]`x`args[1]`x`args[2]`
        0x2:
          id:  move_tile
          doc: |
            Move tile at `args[0]`x`args[0]`x`args[2]` to
            `args[3]`x`args[4]`x`args[2]`.  *Note that this can not be used to
            move tiles between layers!*
        0x3:
          id:  draw_tile
        0x4:
          id:  speak_hero
          doc: |
            Show speech bubble next to hero. _Uses `text` attribute_.

            Script execution is paused until the speech bubble is dismissed.
        0x5:
          id:  speak_npc
          doc: |
            Show speech bubble at `args[0]`x`args[1]`. _Uses `text`
            attribute_. The characters `¢` and `¥` are used as placeholders
            for provided and required items of the current zone, respectively.

            Script execution is paused until the speech bubble is dismissed.
        0x6:
          id:  set_tile_needs_display
          doc: Redraw tile at `args[0]`x`args[1]`
        0x7:
          id:  set_rect_needs_display
          doc: |
            Redraw the part of the current scene, specified by a rectangle
            positioned at `args[0]`x`args[1]` with width `args[2]` and height
            `args[3]`.
        0x8:
          id:  wait
          doc: Pause script execution for one tick.
        0x9:
          id:  redraw
          doc: Redraw the whole scene immediately
        0xa:
          id:  play_sound
          doc: Play sound specified by `args[0]`
        0xb:
          id:  stop_sound
          doc: Stop playing sounds
        0xc:
          id:  roll_dice
          doc: |
            Set current zone's `random` to a random value between 1 and
            `args[0]`.
        0xd:
          id:  set_counter
          doc: Set current zone's `counter` value to a `args[0]`
        0xe:
          id:  add_to_counter
          doc: Add `args[0]` to current zone's `counter` value
        0xf:
          id:  set_variable
          doc: |
            Set variable identified by `args[0]`⊕`args[1]`⊕`args[2]` to
            `args[3]`.  Internally this is implemented as opcode 0x00, setting
            tile at `args[0]`x`args[1]`x`args[2]` to `args[3]`.
        0x10:
          id:  hide_hero
          doc: Hide hero
        0x11:
          id:  show_hero
          doc: Show hero
        0x12:
          id: move_hero_to
          doc: |
            Set hero's position to `args[0]`x`args[1]` ignoring impassable
            tiles.  Execute hotspot actions, redraw the current scene and move
            camera if the hero is not hidden.
        0x13:
          id: move_hero_by
          doc: |
            Moves hero relative to the current location by `args[0]` in x and
            `args[1]` in y direction.
        0x14:
          id: disable_action
          doc: |
            Disable current action, note that there's no way to activate the
            action again.
        0x15:
          id: enable_hotspot
          doc: Enable hotspot `args[0]` so it can be triggered.
        0x16:
          id: disable_hotspot
          doc: Disable hotspot `args[0]` so it can't be triggered anymore.
        0x17:
          id:  enable_monster
          doc: Enable monster `args[0]`
        0x18:
          id: disable_monster
          doc: Disable monster `args[0]`
        0x19:
          id: enable_all_monsters
          doc: Enable all monsters
        0x1a:
          id: disable_all_monsters
          doc: Disable all monsters
        0x1b:
          id: drop_item
          doc: |
            Drops item `args[0]` for pickup at `args[1]`x`args[2]`. If the
            item is 0xFFFF, it drops the current sector's find item instead.

            Script execution is paused until the item is picked up.
        0x1c:
          id: add_item
          doc: Add tile with id `args[0]` to inventory
        0x1d:
          id: remove_item
          doc: Remove one instance of item `args[0]` from the inventory
        0x1e:
          id: mark_as_solved
          doc: |
            Marks current sector solved for the overview map.
        0x1f:
          id: win_game
          doc: Ends the current story by winning.
        0x20:
          id: lose_game
          doc: Ends the current story by losing.
        0x21:
          id: change_zone
          doc: |
            Change current zone to `args[0]`. Hero will be placed at
            `args[1]`x`args[2]` in the new zone.
        0x22:
          id:  set_shared_counter
          doc: Set current zone's `shared_counter` value to a `args[0]`
        0x23:
          id:  add_to_shared_counter
          doc: Add `args[0]` to current zone's `shared_counter` value
        0x24:
          id:  set_random
          doc: Set current zone's `random` value to a `args[0]`
        0x25:
          id:  add_health
          doc: |
            Increase hero's health by `args[0]`. New health is capped at
            hero's max health (0x300). Argument 0 can also be negative
            subtract from hero's health.
  monster:
    doc: A monster is a enemy in a zone.
    seq:
      - id: character
        type: u2
      - id: x
        type: u2
      - id: y
        type: u2
  zone:
    seq:
      - id: marker
        contents: &quot;IZON&quot;
      - id: size2
        type: u4
      - id: width
        doc: Width of the zone in tiles. Either 9 or 18.
        type: u2
      - id: height
        doc: Height of the zone in tiles. Either 9 or 18.
        type: u2
      - id: type
        enum: zone_type
        type: u4
      - id: tile_ids
        type: zone_spot
        repeat: expr
        repeat-expr: width * height
        doc: |
          `tile_ids` is made up of three interleaved tile layers ordered from
          bottom (floor) to top (roof).
          Tiles are often references via 3 coordinates (xyz), which
          corresponds to an index into this array calculated as `n = y * width
          * 3 + x * 3 = z`.
    enums:
      planet:
        0: none
        1: desert
        2: snow
        3: forest
        5: swamp
      zone_type:
        0:
          id: none
        1:
          id: empty
          doc: |
            Empty zones do not contain a puzzle to be solved and are used to
            fill the space between between zones that are relevant for winning
            the game.
        2:
          id: blockade_north
          doc: |
            This type of zone blocks access to sectors north of it until the
            puzzle is solved.
        3:
          id: blockade_south
          doc: |
            This type of zone blocks access to sectors south of it until the
            puzzle is solved.
        4:
          id: blockade_east
          doc: |
            This type of zone blocks access to sectors east of it until the
            puzzle is solved.
        5:
          id: blockade_west
          doc: |
            This type of zone blocks access to sectors west of it until the
            puzzle is solved.
        6:
          id: travel_start
          doc: |
            Starting point to travel to an island on the edge of the world.
            `travel_start` and `travel_end` zones are connected through
            hotspot of type `vehicle_to` and `vehicle_back`.
        7:
          id: travel_end
          doc: |
            Travel target that is only placed on an island at the edge of the
            world map during world generation.
        8:
          id: room
          doc: |
            A zone that can not be placed on the world map directly. Instead
            rooms are accessed via actions or hotspots of type `door_in`. They
            usually contain at least one `door_out` hotspot to get back to the
            other zone.
        9:
          id: load
          doc: |
            This type of zone is shown after the game has loaded all assets.
            It should resemble the image from the catalog entry of type
            `startup_image` for a smooth transition from loading to game play.
        10:
          id: goal
          doc: |
            Every world contains exactly one goal zone. Solving this zone wins
            the game.
        11:
          id: town
          doc: |
            This is the entry zone where the hero arrives after leaving the
            swamp planet. Each planet can only have one town zone.
        13:
          id: win
          doc: |
            Shown when a game is won. The score is rendered above the tiles at
            coordinates 5x7 and 6x7.
        14:
          id: lose
          doc: |
            Shown when a game is lost.
        15:
          id: trade
          doc: |
            In order to solve this zone and gain a new item the hero has to
            trade something in.
        16:
          id: use
          doc: |
            This type of zone can be solved by making applying a tool or using
            a keycard.
        17:
          id: find
          doc: |
            This type of zone can be solved without using items.
        18:
          id: find_unique_weapon
          doc: |
            This zone provides the hero with a unique weapon and will be
            placed closed to a town zone.
  zone_spot:
    seq:
      - id: column
        doc: from bottom to top, 0xFFFF indicates empty tiles
        type: u2
        repeat: expr
        repeat-expr: 3
  hotspot:
    doc: |
      In addition to actions some puzzles and events are triggered by
      hotspots. These hotspots are triggered when the hero steps on them or
      places an item at the location. Additionally, hotspots are used during
      world generation to mark places where NPCs can spawn.
    seq:
      - id: type
        type: u4
        enum: hotspot_type
      - id: x
        type: u2
      - id: y
        type: u2
      - id: enabled
        doc: |
          If disabled, hotspots can not be triggered. See instruction opcodes
          called `enable_hotspot` and `disable_hotspot`.
        type: u2
      - id: argument
        type: u2
    enums:
      hotspot_type:
        0:
          id: drop_quest_item
          doc: |
            Drops the item provided by the zone when solved. Can be set to a
            specific item, or to `0xFFFF` to use the one from the currently
            assigned puzzle.
        1:
          id: spawn_location
          doc: |
            Possible spawn location for one of the zone's NPCs.
        2:
          id: drop_unique_weapon
          doc: |
            Hotspot that drops the unique weapon found in zones of type
            `find_unique_weapon`.
        3:
          id: vehicle_to
          doc: |
            Used in `travel_start` zones as a trigger to teleport to the
            corresponding `travel_end` zone. The hotspot argument contains the
            id of the zone to teleport to.
        4:
          id: vehicle_back
          doc: |
            Counter part to `vehicle_to` hotspots. This is used to determine
            the hero's position on the zone after the `vehicle_to` hotspot has
            been triggered and to teleport back to the zone on main land.
        5:
          id: drop_map
          doc: |
            Hotspot that drops the map (aka locator) tile. One `find` zone
            with a hotspot of this type will be placed next to a town during
            world generation.
        6:
          id: drop_item
          doc: |
             Hotspot that, when triggered drops the item specified in the
             hotspot's argument. If the item is set to `0xFFFF` the zone's
             quest item will be dropped.
        7:
          id: npc
          doc: |
            This seems to be a placeholder for a pre-assigned NPC.
        8:
          id: drop_weapon
          doc: |
            Drops a weapon (specified by the hotspot argument) when triggered.
        9:
          id: door_in
          doc: |
            When triggered this hotspot type move the hero to the zone
            specified in the hotspot argument. The hero's location on the new
            zone will be determined by a corresponding `door_out` hotspot in
            the target zone.
        10:
          id: door_out
          doc: |
            Determines where the hero will be placed when the zone is entered
            through a door. When triggered, this transports the player back to
            the `door_in` hotspot they game from.
        11: unused
        12: lock
        13:
          id: teleporter
          doc: |
            Teleporter hotspots can be used to instantly teleport to other
            (visited) teleporters on the map
        14:
          id: ship_to_planet
          doc: |
            Behaves similar to the `vehicle_to` hotspot type but travels
            between the town and the swamp planet.
        15:
          id: ship_from_planet
          doc: |
            Behaves similar to the `vehicle_back` hotspot type but travels
            between the town and the swamp planet.

  zone_auxiliary:
    seq:
      - id: marker
        contents: &quot;IZAX&quot;
      - id: size
        type: u4
      - type: u2
      - id: num_monsters
        type: u2
      - id: monsters
        type: monster
        repeat: expr
        repeat-expr: num_monsters
      - id: num_required_items
        type: u2
      - id: required_items
        doc: List of items that can be used to solve the zone.
        type: u2
        repeat: expr
        repeat-expr: num_required_items
  zone_auxiliary_2:
    seq:
      - id: marker
        contents: &quot;IZX2&quot;
      - id: size
        type: u4
      - id: num_provided_items
        type: u2
      - id: provided_items
        doc: Items that can be gained when the zone is solved.
        type: u2
        repeat: expr
        repeat-expr: num_provided_items
  zone_auxiliary_3:
    seq:
      - id: marker
        contents: &quot;IZX3&quot;
      - id: size
        type: u4
      - id: num_npcs
        type: u2
      - id: npcs
        doc: |
          NPCs that can be placed in the zone to trade items with the hero.
        type: u2
        repeat: expr
        repeat-expr: num_npcs
  zone_auxiliary_4:
    seq:
      - id: marker
        contents: &quot;IZX4&quot;
      - id: size
        type: u4
      - type: u2
  zones:
    seq:
      - id: num_zones
        type: u2
      - id: zones
        type: zone
        repeat: expr
        repeat-expr: num_zones
  puzzles:
    seq:
      - id: puzzles
        type: puzzle
        repeat: until
        repeat-until: _.index == 0xFF_FF
  puzzle:
    seq:
      - id: index
        type: u2
      - id: marker
        if: index != 0xFF_FF
        contents: &quot;IPUZ&quot;
      - id: size
        type: u4
        if: index != 0xFF_FF
      - id: item1_class
        type: u4
        enum: puzzle_item_class
        if: index != 0xFF_FF
      - id: item2_class
        type: u4
        enum: puzzle_item_class
        if: index != 0xFF_FF
      - type: u2
        if: index != 0xFF_FF
      - id: strings
        type: prefixed_str
        repeat: expr
        repeat-expr: 5
        if: index != 0xFF_FF
      - id: item_1
        type: u2
        if: index != 0xFF_FF
    enums:
      puzzle_item_class:
        0: keycard
        1: tool
        2: part
        4: valuable
        0xFFFF_FFFF: none
  endf:
    seq: []
  tgen:
    doc: |
        The TGEN section is only present in non-english versions of the game. It's purpose or
        internal structure is unknown.
    seq:
      - id: data
        size: _parent.size
  characters:
    seq:
      - id: characters
        type: character
        repeat: until
        repeat-until: _.index == 0xFF_FF
  character:
    seq:
      - id: index
        type: u2
      - id: marker
        contents: &quot;ICHA&quot;
        if: index != 0xFF_FF
      - id: size
        type: u4
        if: index != 0xFF_FF
      - id: name
        type: strz
        size: 16
        if: index != 0xFF_FF
      - id: type
        type: u2
        enum: character_type
        if: index != 0xFF_FF
      - id: movement_type
        type: u2
        enum: movement_type
        if: index != 0xFF_FF
      - id: frame_1
        type: char_frame
        if: index != 0xFF_FF
      - id: frame_2
        type: char_frame
        if: index != 0xFF_FF
      - id: frame_3
        type: char_frame
        if: index != 0xFF_FF
    enums:
      character_type:
        1: hero
        2: enemy
        4: weapon
      movement_type:
        0: none
        4: sit
        9: wander
        10: patrol
        12: animation
  char_frame:
    seq:
      - id: tiles
        type: u2
        repeat: expr
        repeat-expr: 0x8
  character_auxiliaries:
    seq:
      - id: auxiliaries
        type: character_auxiliary
        repeat: until
        repeat-until: _.index == 0xFF_FF
  character_auxiliary:
    seq:
      - id: index
        type: u2
      - id: damage
        type: s2
        if: index != 0xFF_FF
  character_weapons:
    seq:
      - id: weapons
        type: character_weapon
        repeat: until
        repeat-until: _.index == 0xFF_FF
  character_weapon:
    seq:
      - id: index
        type: u2
      - id: reference
        doc: |
          If the character referenced by index is a monster, this is a
          reference to their weapon, otherwise this is the index of the
          weapon's sound
        type: u2
        if: index != 0xFF_FF
      - id: health
        type: u2
        if: index != 0xFF_FF
  action_names:
    seq:
      - id: names
        type: zone_action_name
        repeat: until
        repeat-until:  _.zone_id == 0xFF_FF
  zone_action_name:
    seq:
      - id: zone_id
        type: u2
      - id: action_names
        type: action_name
        repeat: until
        repeat-until: _.action_id == 0xFF_FF
        if: zone_id != 0xFF_FF
  action_name:
    seq:
      - id: action_id
        type: u2
      - id: name
        type: strz
        size: 0x10
        if: action_id != 0xFF_FF
  puzzle_names:
    seq:
      - id: num_puzzle_names
        type: u2
      - id: puzzle_names
        type: strz
        size: 0x10
        repeat: expr
        repeat-expr: num_puzzle_names
  zone_names:
    seq:
      - id: zone_names
        type: zone_name
        repeat: until
        repeat-until: _.zone_id == 0xFF_FF
  zone_name:
    seq:
      - id: zone_id
        type: u2
      - id: name
        type: strz
        size: 0x10
        if: zone_id != 0xFF_FF
  hotspots:
    seq:
      - id: zone_hotspots
        type: zone_hotspot
        repeat: until
        repeat-until: _.zone_id == 0xFF_FF
  zone_hotspot:
    seq:
      - id: zone_id
        type: u2
      - id: num_hotspots
        type: u2
        if: zone_id != 0xFF_FF
      - id: hotspots
        type: hotspot
        repeat: expr
        repeat-expr: num_hotspots
        if: zone_id != 0xFF_FF
  actions:
    seq:
      - id: zone_actions
        type: zone_action
        repeat: until
        repeat-until: _.zone_id == 0xFF_FF
  zone_action:
    seq:
      - id: zone_id
        type: u2
      - id: num_actions
        type: u2
        if: zone_id != 0xFF_FF
      - id: actions
        type: action
        repeat: expr
        repeat-expr: num_actions
        if: zone_id != 0xFF_FF
  zones_aux_1:
    seq:
      - id: zone_auxiliaries
        type: zone_auxiliary
        repeat: expr
        repeat-expr: _root.catalog[4].content.as&lt;zones&gt;.num_zones
  zones_aux_2:
    seq:
      - id: zone_auxiliaries
        type: zone_auxiliary_2
        repeat: expr
        repeat-expr: _root.catalog[4].content.as&lt;zones&gt;.num_zones
  zones_aux_3:
    seq:
      - id: zone_auxiliaries
        type: zone_auxiliary_3
        repeat: expr
        repeat-expr: _root.catalog[4].content.as&lt;zones&gt;.num_zones
  zones_aux_4:
    seq:
      - id: zone_auxiliaries
        type: zone_auxiliary_4
        repeat: expr
        repeat-expr: _root.catalog[4].content.as&lt;zones&gt;.num_zones
  # Utilities
  prefixed_str:
    seq:
      - id: len_content
        type: u2
      - id: content
        type: str
        size: len_content
  prefixed_strz:
    seq:
      - id: len_content
        type: u2
      - id: content
        type: strz
        size: len_content

</code></pre>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/cyco/webfun//edit/master/docs/src/appendix/deskadv.md">Edit this file on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../appendix/yodesk.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../appendix/yodasav.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../appendix/yodesk.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../appendix/yodasav.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
