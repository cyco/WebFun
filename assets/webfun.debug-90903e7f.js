(self.webpackChunkwebfun=self.webpackChunkwebfun||[]).push([[711],{43718:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0}),t.ReplayingInputManager=t.RecordingInputManager=t.Syntax=void 0;var i=n(74216);t.RecordingInputManager=i.default;var r=n(40538);t.ReplayingInputManager=r.default;var a=n(67766);t.Syntax=a.default},26193:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(68748)),a=i(n(36029));(0,r.default)(t,"__esModule",{value:!0}),t.assemble=t.parse=void 0;var o=n(67766);t.parse=function(e){if(!e.length)return[];for(var t=[],n=0;n<e.length;n++){var i=e[n];switch(i){case" ":case"\n":continue;case o.default.Comment:var r=o.default.Comment;for(n+=1;n<e.length&&"\n"!==(i=e[n]);n++)r+=i;t.push(r);break;case o.default.Attack[0]:case o.default.Place.Start[0]:if(e[n+1]===o.default.Attack[1]){t.push(o.default.Attack),n+=o.default.Attack.length;break}t.push(o.default.Place.Start),n+=o.default.Place.Start.length+1;for(var a="";n<e.length&&" "!==(i=e[n]);n++)a+=i;t.push(a),"a"===e[n+=1]&&"t"===e[n+1]&&(t.push("at"),n+=3);for(var u="";n<e.length&&" "!==(i=e[n]);n++)u+=i;t.push(u);break;default:t.push(i)}}return t},t.assemble=function(e){if(!e||0===e.length)return".";for(var t="",n=0;n<e.length;n++){var i=e[n];i[0]===o.default.Comment?t=(0,a.default)(t).call(t)+"\n"+i+"\n":t+=i+" "}return t}},74216:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361)),a=i(n(7583)),o=i(n(68748)),u=i(n(47053));(0,o.default)(t,"__esModule",{value:!0});var s=n(8120),l=n(34159),c=n(20779),d=n(67766),f=function(){function e(t){(0,r.default)(this,e),this._records=[],this.isRecording=!1,this.implementation=t}return(0,a.default)(e,[{key:"clearRecords",value:function(){this._records=[]}},{key:"records",get:function(){return this._records},set:function(e){this._records=e}},{key:"recordOne",value:function(){var e,t=this.implementation.readInput(0);(this._input=t,this.isRecording)&&(t&s.default.Attack?this._records.push(d.default.Attack):t&s.default.Walk&&t&s.default.Drag&&(e=this._currentDragDirection())?this._records.push(d.default.Drag[e]):t&s.default.Walk&&(e=this._currentMoveDirection())?this._records.push(d.default.Move[e]):this._records.push("."))}},{key:"_currentDragDirection",value:function(){return this.directions&l.Direction.Up?"North":this.directions&l.Direction.Down?"South":this.directions&l.Direction.Left?"West":this.directions&l.Direction.Right?"East":null}},{key:"_currentMoveDirection",value:function(){var e=this,t=function(t){return(e.directions&t)===t};return t(l.Direction.Up|l.Direction.Left)?"NorthWest":t(l.Direction.Up|l.Direction.Right)?"NorthEast":t(l.Direction.Down|l.Direction.Left)?"SouthWest":t(l.Direction.Down|l.Direction.Right)?"SouthEast":t(l.Direction.Up)?"North":t(l.Direction.Down)?"South":t(l.Direction.Left)?"West":t(l.Direction.Right)?"East":null}},{key:"addListeners",value:function(){this.implementation.engine.metronome.addEventListener(c.Metronome.Event.Start,this),this.implementation.engine.metronome.addEventListener(c.Metronome.Event.BeforeTick,this),this.implementation.engine.addEventListener(c.Engine.Event.WeaponChanged,this),this.implementation&&this.implementation.addListeners()}},{key:"removeListeners",value:function(){this.implementation&&this.implementation.removeListeners(),this.implementation.engine.removeEventListener(c.Engine.Event.WeaponChanged,this),this.implementation.engine.metronome.removeEventListener(c.Metronome.Event.Start,this),this.implementation.engine.metronome.removeEventListener(c.Metronome.Event.BeforeTick,this)}},{key:"clear",value:function(){this.implementation&&this.implementation.clear(),this._input=0}},{key:"mouseLocationInView",get:function(){return this.implementation&&this.implementation.mouseLocationInView}},{key:"mouseDownHandler",get:function(){return this.implementation.mouseDownHandler},set:function(e){this.implementation&&(this.implementation.mouseDownHandler=e)}},{key:"keyDownHandler",get:function(){return this.implementation&&this.implementation.keyDownHandler},set:function(e){this.implementation&&(this.implementation.keyDownHandler=e)}},{key:"currentItem",get:function(){return this.implementation&&this.implementation.currentItem},set:function(e){this.implementation&&(this.implementation.currentItem=e)}},{key:"handleEvent",value:function(e){if(e.type!==c.Engine.Event.WeaponChanged)if(e.type===c.Metronome.Event.Start&&this.placedTile&&this.placedTileLocation){var t,n,i,r,a=this.placedTile.id,o=this.placedTileLocation,s=o.x,l=o.y;this._records.push((0,u.default)(t=(0,u.default)(n=(0,u.default)(i=(0,u.default)(r="".concat(d.default.Place.Start," ")).call(r,a.toHex(3)," at ")).call(i,s,"x")).call(n,l)).call(t,d.default.Place.End))}else;else{var f,h,p=e.detail.weapon.id;this._records.push((0,u.default)(f=(0,u.default)(h="".concat(d.default.Place.Start," ")).call(h,p.toHex(3))).call(f,d.default.Place.End))}}},{key:"engine",get:function(){return this.implementation.engine},set:function(e){this.implementation&&(this.implementation.engine=e)}},{key:"readInput",value:function(e){return this.recordOne(),this._input}},{key:"directions",get:function(){var e=this._input,t=0;return e&s.default.Up&&(t|=l.Direction.Up),e&s.default.Down&&(t|=l.Direction.Down),e&s.default.Left&&(t|=l.Direction.Left),e&s.default.Right&&(t|=l.Direction.Right),t}}]),e}();t.default=f},40538:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(94433)),o=r(n(40361)),u=r(n(7583)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244)),d=r(n(68748)),f=r(n(35983));function h(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,d.default)(t,"__esModule",{value:!0}),t.Event=void 0;var p=n(8120),v=n(34159),m=n(20779),g=n(17766),y=n(31560),_=n(67766),k=n(26193);t.Event={InputEnd:"InputEnd"};var b=function(e){(0,s.default)(i,e);var n=h(i);function i(){var e;return(0,o.default)(this,i),(e=n.apply(this,arguments)).isReplaying=!1,e._input=[],e.mouseLocationInView=new y.Point(0,0),e.placedTile=null,e.placedTileLocation=null,e.locator=!1,e.pause=!1,e.scrollDown=!1,e.scrollUp=!1,e.endDialog=!1,e._offset=0,e}return(0,u.default)(i,[{key:"reset",value:function(){this._offset=0}},{key:"handleEvent",value:function(e){if(this.token===_.default.Place.Start){var n;this._offset++;var i=this.token.parseInt(),r=this.engine.assets.get(g.Tile,i);if(this._offset++,"at"!==this.token)return void(r.hasAttributes(g.Tile.Attributes.Edible)?this.engine.consume(r):this.engine.equip(r));this._offset++;var o=(0,f.default)(n=this.token.split("x")).call(n,(function(e){return e.parseInt()})),u=(0,a.default)(o,2),s=u[0],l=u[1];this.engine.inventory.contains(r)&&(this.placedTile=r,this.placedTileLocation=new y.Point(s,l))}""===this.token&&this.dispatchEvent(new CustomEvent(t.Event.InputEnd))}},{key:"readInput",value:function(e){var t=p.default.None;this.pause&&(t|=p.default.Pause),this.locator&&(t|=p.default.Map),this.endDialog&&(t|=p.default.EndDialog),this.scrollDown&&(t|=p.default.ScrollDown),this.scrollUp&&(t|=p.default.ScrollUp);var n=this.directions;return n&v.Direction.Left&&(t|=v.Direction.Left),n&v.Direction.Up&&(t|=v.Direction.Up),n&v.Direction.Down&&(t|=v.Direction.Down),n&v.Direction.Right&&(t|=v.Direction.Right),this.walk&&(t|=p.default.Walk),this.drag&&(t|=p.default.Drag),this.attack&&(t|=p.default.Attack),this._offset++,t}},{key:"clear",value:function(){this.placedTile=null,this.placedTileLocation=null}},{key:"addListeners",value:function(){this.engine.metronome.addEventListener(m.Metronome.Event.AfterTick,this)}},{key:"removeListeners",value:function(){this.engine.metronome.removeEventListener(m.Metronome.Event.AfterTick,this)}},{key:"token",get:function(){if(this._offset<this._input.length){var e=this._input[this._offset];return e&&e[0]===_.default.Comment?(this._offset++,this.token):e}return""}},{key:"directions",get:function(){switch(this.token){case _.default.Move.East:case _.default.Drag.East:return v.Direction.Right;case _.default.Move.West:case _.default.Drag.West:return v.Direction.Left;case _.default.Drag.North:case _.default.Move.North:return v.Direction.Up;case _.default.Drag.South:case _.default.Move.South:return v.Direction.Down;case _.default.Move.SouthEast:return v.Direction.Down|v.Direction.Right;case _.default.Move.NorthEast:return v.Direction.Up|v.Direction.Right;case _.default.Move.NorthWest:return v.Direction.Up|v.Direction.Left;case _.default.Move.SouthWest:return v.Direction.Down|v.Direction.Left;default:return 0}}},{key:"walk",get:function(){switch(this.token){case _.default.Drag.East:case _.default.Drag.West:case _.default.Drag.North:case _.default.Drag.South:case _.default.Move.North:case _.default.Move.NorthEast:case _.default.Move.East:case _.default.Move.SouthEast:case _.default.Move.South:case _.default.Move.SouthWest:case _.default.Move.West:case _.default.Move.NorthWest:return!0;default:return!1}}},{key:"drag",get:function(){switch(this.token){case _.default.Drag.North:case _.default.Drag.East:case _.default.Drag.South:case _.default.Drag.West:return!0;default:return!1}}},{key:"attack",get:function(){return this.token===_.default.Attack}},{key:"input",get:function(){return k.assemble(this._input)},set:function(e){this._input=k.parse(e),this.reset()}}]),i}(y.EventTarget);b.Event=t.Event,t.default=b},67766:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0}),t.default={Move:{West:"←",East:"→",North:"↑",South:"↓",NorthWest:"↖",NorthEast:"↗",SouthEast:"↘",SouthWest:"↙"},Drag:{West:"⇠",East:"⇢",North:"⇡",South:"⇣"},Place:{Start:"👋",End:""},Attack:"🔫",Comment:"#",Wait:"."}},9705:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361)),a=i(n(7583)),o=i(n(68748)),u=i(n(68190)),s=i(n(35983));(0,o.default)(t,"__esModule",{value:!0});var l=function(){function e(t){(0,r.default)(this,e),this._zone=t}return(0,a.default)(e,[{key:"evaluate",value:function(e){var t=this;it("the current zone is ".concat(this._zone.toHex(3)),(function(){expect(e.engine.currentZone.id).toBe(t._zone)}))}},{key:"format",value:function(){return"Current zone is ".concat(this._zone.toHex(3))}}],[{key:"CanBeBuiltFrom",value:function(e){return e.contains("zone")&&e.contains("is")||e.contains("zone:")}},{key:"BuildFrom",value:function(t){var n,i;return new e((0,u.default)(n=(0,s.default)(i=t.value.split(" ")).call(i,(function(e){return e.parseInt()}))).call(n,(function(e){return!isNaN(e)}))[0])}}]),e}();t.default=l},22066:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361)),a=i(n(7583)),o=i(n(68748)),u=i(n(36029));(0,o.default)(t,"__esModule",{value:!0});var s=function(){function e(t){(0,r.default)(this,e),this._health=t}return(0,a.default)(e,[{key:"evaluate",value:function(e){var t=this;it("the hero's health is ".concat(this._health.toHex(3)),(function(){expect(e.engine.hero.health).toBe(t._health)}))}},{key:"format",value:function(){return"Health is ".concat(this._health.toHex(3))}}],[{key:"CanBeBuiltFrom",value:function(e){return e.toLowerCase().contains("health")}},{key:"BuildFrom",value:function(t){var n;return new e((0,u.default)(n=t.value).call(n).split(" ").last().parseInt())}}]),e}();t.default=s},60309:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0}),t.ZoneSolvedExpectation=t.UnknownExpectation=t.TicksExpectation=t.StorySolvedExpectation=t.NOPExpectation=t.InventoryContainsNotExpectation=t.InventoryContainsExpectation=t.HealthIsExpectation=t.CurrentZoneIsExpectation=void 0;var i=n(10787);t.InventoryContainsExpectation=i.default;var r=n(7037);t.UnknownExpectation=r.default;var a=n(9472);t.NOPExpectation=a.default;var o=n(86795);t.ZoneSolvedExpectation=o.default;var u=n(8917);t.StorySolvedExpectation=u.default;var s=n(65900);t.InventoryContainsNotExpectation=s.default;var l=n(59011);t.TicksExpectation=l.default;var c=n(9705);t.CurrentZoneIsExpectation=c.default;var d=n(22066);t.HealthIsExpectation=d.default},65900:(e,t,n)=>{"use strict";var i=n(92915),r=n(69159),a=n(67986),o=n(13037),u=n(29689),s=n(38468),l=s(n(40361)),c=s(n(7583)),d=s(n(68748)),f=s(n(35983)),h=s(n(47053)),p=s(n(20794)),v=s(n(36029));function m(e,t){var n=void 0!==a&&o(e)||e["@@iterator"];if(!n){if(u(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return g(e,t);var a=i(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return r(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var s=0,l=function(){};return{s:l,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,d=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){f=!0,c=e},f:function(){try{d||null==n.return||n.return()}finally{if(f)throw c}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}(0,d.default)(t,"__esModule",{value:!0});var y=function(){function e(t){(0,l.default)(this,e),this.items=t}return(0,c.default)(e,[{key:"format",value:function(){var e;return"Inventory does not contain: ".concat((0,f.default)(e=this.items).call(e,(function(e){return e.toHex(3)})).join(", "))}},{key:"evaluate",value:function(e){var t,n=this;it("hero does not have items ".concat((0,f.default)(t=this.items).call(t,(function(e){return e.toHex(3)})).join(", ")),(function(){var t,i=m(n.items);try{for(i.s();!(t=i.n()).done;){var r,a,o=t.value;if(e.engine.inventory.contains(o)){var u=n.items.length>1?(0,h.default)(r="Expected inventory not to contain items ".concat((0,f.default)(a=n.items).call(a,(function(e){return e.toHex(3)})).join(", "),", but ")).call(r,o.toHex(3)," is there."):"Expected inventory not to contain item ".concat(o.toHex(3),".");fail(u)}}}catch(e){i.e(e)}finally{i.f()}}))}}],[{key:"CanBeBuiltFrom",value:function(e){return(0,p.default)(e).call(e,"inventory")&&e.contains("not")}},{key:"BuildFrom",value:function(t){var n,i;return new e((0,f.default)(n=(0,f.default)(i=t.value.split(":")[1].split(", ")).call(i,(function(e){return(0,v.default)(e).call(e)}))).call(n,(function(e){return e.parseInt()})))}}]),e}();t.default=y},10787:(e,t,n)=>{"use strict";var i=n(92915),r=n(69159),a=n(67986),o=n(13037),u=n(29689),s=n(38468),l=s(n(40361)),c=s(n(7583)),d=s(n(68748)),f=s(n(35983)),h=s(n(47053)),p=s(n(68190)),v=s(n(36029));function m(e,t){var n=void 0!==a&&o(e)||e["@@iterator"];if(!n){if(u(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return g(e,t);var a=i(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return r(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var s=0,l=function(){};return{s:l,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,d=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){f=!0,c=e},f:function(){try{d||null==n.return||n.return()}finally{if(f)throw c}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}(0,d.default)(t,"__esModule",{value:!0});var y=n(64230),_=function(){function e(t){(0,l.default)(this,e),this.items=t}return(0,c.default)(e,[{key:"format",value:function(){var e;return"Inventory: ".concat((0,f.default)(e=this.items).call(e,(function(e){return e.toHex(3)})).join(", "))}},{key:"evaluate",value:function(e){var t,n=this;it("hero has items ".concat((0,f.default)(t=this.items).call(t,(function(e){return e.toHex(3)})).join(", ")),(function(){var t,i=m(n.items);try{for(i.s();!(t=i.n()).done;){var r,a,o=t.value;if(!e.engine.inventory.contains(o)){var u=n.items.length>1?(0,h.default)(r="Expected inventory to contain items ".concat((0,f.default)(a=n.items).call(a,(function(e){return e.toHex(3)})).join(", "),", but ")).call(r,o.toHex(3)," is missing."):"Expected inventory to contain item ".concat(o.toHex(3),".");fail(u)}}}catch(e){i.e(e)}finally{i.f()}}))}}],[{key:"CanBeBuiltFrom",value:function(e){return e.contains("inventory")&&!e.contains("not")}},{key:"BuildFrom",value:function(t){var n,i;return new e((0,p.default)(n=(0,f.default)(i=t.value.split(/[^A-Za-z0-9]+/)).call(i,(function(e){return(0,v.default)(e).call(e).parseInt()}))).call(n,y.not(isNaN)))}}]),e}();t.default=_},9472:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361)),a=i(n(7583));(0,i(n(68748)).default)(t,"__esModule",{value:!0});var o=function(){function e(){(0,r.default)(this,e)}return(0,a.default)(e,[{key:"evaluate",value:function(e){it("does nothing, really",(function(){}))}},{key:"format",value:function(){return"NOP"}}],[{key:"CanBeBuiltFrom",value:function(e){return e.contains("nop")}},{key:"BuildFrom",value:function(t){return new e}}]),e}();t.default=o},8917:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361)),a=i(n(7583));(0,i(n(68748)).default)(t,"__esModule",{value:!0});var o=n(20779),u=function(){function e(){(0,r.default)(this,e)}return(0,a.default)(e,[{key:"evaluate",value:function(e){it("the story is solved",(function(){expect(e.engine.gameState).toBe(o.GameState.Won)}))}},{key:"format",value:function(){return"Story solved"}}],[{key:"CanBeBuiltFrom",value:function(e){return e.contains("story")&&e.contains("solved")||e.contains("game")&&e.contains("won")}},{key:"BuildFrom",value:function(t){return new e}}]),e}();t.default=u},59011:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361)),a=i(n(7583)),o=i(n(68748)),u=i(n(68190)),s=i(n(35983)),l=i(n(36029));(0,o.default)(t,"__esModule",{value:!0});var c=n(64230),d=function(){function e(t){(0,r.default)(this,e),this._ticks=t}return(0,a.default)(e,[{key:"evaluate",value:function(e){var t=this;it("the proper amount of ticks have been executed",(function(){expect(e.engine.metronome.tickCount).toEqual(t._ticks)}))}},{key:"format",value:function(){return"Elapsed Ticks: ".concat(this._ticks.toString())}}],[{key:"CanBeBuiltFrom",value:function(e){return e.contains("ticks")}},{key:"BuildFrom",value:function(t){var n,i;return new e((0,u.default)(n=(0,s.default)(i=t.value.split(/[^A-Za-z0-9]+/)).call(i,(function(e){return(0,l.default)(e).call(e).parseInt()}))).call(n,c.not(isNaN)).first())}}]),e}();t.default=d},7037:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361)),a=i(n(7583));(0,i(n(68748)).default)(t,"__esModule",{value:!0});var o=function(){function e(t){(0,r.default)(this,e),this.line=t}return(0,a.default)(e,[{key:"evaluate",value:function(){throw"Don't know how to handle expectation ".concat(this.line)}},{key:"format",value:function(){return this.line}}],[{key:"CanBeBuiltFrom",value:function(e){return!0}},{key:"BuildFrom",value:function(t){return new e(t.value)}}]),e}();t.default=o},86795:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361)),a=i(n(7583));(0,i(n(68748)).default)(t,"__esModule",{value:!0});var o=function(){function e(){(0,r.default)(this,e)}return(0,a.default)(e,[{key:"evaluate",value:function(e){it("the zone is solved",(function(){var t=e.engine.currentWorld.at(4,4);expect(t.solved1).toBeTrue(),expect(t.solved2).toBeTrue()}))}},{key:"format",value:function(){return"Zone solved"}}],[{key:"CanBeBuiltFrom",value:function(e){return e.contains("solved")&&e.contains("zone")}},{key:"BuildFrom",value:function(t){return new e}}]),e}();t.default=o},4671:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(63789)),a=i(n(76108)),o=i(n(40361)),u=i(n(7583)),s=i(n(68748)),l=i(n(20778)),c=i(n(47053)),d=i(n(75356)),f=i(n(67093)),h=i(n(79302));(0,s.default)(t,"__esModule",{value:!0});var p,v,m=n(88607),g=n(43718),y=n(46e3),_=n(63806),k=n(27778),b=n(15695),w=n(20779),S=n(17766),x=n(61334),C=n(75747),T=n(50177),I=n(31560),E=n(91092),B=n(61515),z=n(83608),W=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,o.default)(this,e),this.debug=t,this.settings=(0,l.default)({},T.defaultSettings)}var t,n,i,s;return(0,u.default)(e,[{key:"prepare",value:(s=(0,a.default)(r.default.mark((function e(t){var n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=2;break}return e.abrupt("return");case 2:return(n=m.ComponentRegistry.sharedRegistry).contains(b.SceneView)||n.registerComponent(b.SceneView),e.next=6,t(y.Yoda);case 6:return p=e.sent,e.t0=x.ColorPalette,e.next=10,getFixtureData("yoda.pal");case 10:e.t1=e.sent,v=e.t0.FromBGR8Buffer.call(e.t0,e.t1);case 12:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"buildEngine",value:function(){var e=this;this.sceneView=document.createElement(b.SceneView.tagName),this.inputManager=new g.ReplayingInputManager,this.engine=new w.Engine(y.Yoda,{InputManager:function(){return e.inputManager},Renderer:function(){return e.debug?new k.CanvasRenderer.Renderer(e.sceneView.canvas):new C.Renderer},SceneManager:function(){return e.sceneView.manager},AssetManager:function(){return e.buildAssetManagerFromGameData(p)},ScriptProcessingUnit:function(e,t,n){if(void 0===window.__webfun_coverage__)return new z.ScriptProcessingUnit(e,t,n);var i,r,a=new B.default(e,t,n),o=null;return a.delegate={executorWillExecute:function(e,t){if(t instanceof S.Zone&&(i=t,window.__webfun_coverage__.zones[i.id]=window.__webfun_coverage__.zones[i.id]||{},window.__webfun_coverage__.zones[i.id].visited=!0),t instanceof S.Action){var n;r=t;var a=(0,c.default)(n="".concat(i.id.toString(),"_")).call(n,r.id.toString());window.__webfun_coverage__.actions[a]=window.__webfun_coverage__.actions[a]||{},o=window.__webfun_coverage__.actions[a]}if("isCondition"in t){var u,s=(0,d.default)(u=r.conditions).call(u,t);o.conditions=o.conditions||[],o.conditions[s]=o.conditions[s]||0,o.conditions[s]++,window.__webfun_coverage__.conditions[t.opcode]=window.__webfun_coverage__.conditions[t.opcode]||0,window.__webfun_coverage__.conditions[t.opcode]++}if("isInstruction"in t){var l,f=(0,d.default)(l=r.instructions).call(l,t);o.instructions=o.instructions||[],o.instructions[f]=o.instructions[f]||0,o.instructions[f]++,window.__webfun_coverage__.instructions[t.opcode]=window.__webfun_coverage__.instructions[t.opcode]||0,window.__webfun_coverage__.instructions[t.opcode]++}},executorDidExecute:function(e,t){t instanceof S.Zone&&(i=null),t instanceof S.Action&&(r=null)},executorDidDrain:function(e){i=null,r=null}},a}});var t=this.engine.variant;this.engine.palette=new x.PaletteAnimation(v,t.fastColorCycles,t.slowColorCycles),this.engine.settings=this.settings}},{key:"buildAssetManagerFromGameData",value:function(e){var t=new w.GameData(e),n=new w.AssetManager;return n.populate(S.Zone,t.zones),n.populate(S.Tile,t.tiles),n.populate(S.Puzzle,t.puzzles),n.populate(S.Char,t.characters),n.populate(S.Sound,t.sounds),n}},{key:"playNewStory",value:(i=(0,a.default)(r.default.mark((function e(t,n,i,a){var o,u,s=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.length>4&&void 0!==s[4]&&s[4],u=new w.Story(t,n,i),e.next=4,this.playStory(u,a,o);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"setupEngine",value:function(e,t){var n,i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.sceneView,o=this.engine,u=this.inputManager;this.settings.debug=r,this.settings.skipDialogs=!0,this.settings.skipTransitions=!0,this.settings.pickupItemsAutomatically=!0,this.settings.skipWinScene=!0,document.body.appendChild(a),o.story=e,e.generateWorld(o.assets,y.Yoda),o.metronome.tickDuration=1,o.metronome.ontick=function(e){return o.update(e)},o.metronome.onrender=function(){return o.render()},a.manager.engine=o;var s=e instanceof E.SimulatedStory?o.world.at(4,5).zone:(0,f.default)(n=o.assets).call(n,S.Zone,(function(e){return e.isLoadingZone()})),l=new _.ZoneScene(o,s);o.spu.prepareExecution(z.EvaluationMode.JustEntered,s),o.currentZone=s,o.currentWorld=o.world.findLocationOfZone(s)?o.world:null,o.hero.appearance=(0,f.default)(i=o.assets).call(i,S.Char,(function(e){return e.isHero()})),o.sceneManager.pushScene(l),e instanceof E.SimulatedStory?(o.hero.visible=!0,o.hero.location=new I.Point(0,0)):o.currentWorld=e.dagobah,u.engine=o,u.input=t}},{key:"playStory",value:(n=(0,a.default)(r.default.mark((function e(t,n){var i,o=this,u=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.length>2&&void 0!==u[2]&&u[2],e.abrupt("return",new h.default(function(){var e=(0,a.default)(r.default.mark((function e(a){var u;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.setupEngine(t,n,i),o.onInputEnd=function(){return a()},(u=o.engine.inputManager).addEventListener(g.ReplayingInputManager.Event.InputEnd,o.onInputEnd),u.addListeners(),o.engine.metronome.start();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"cleanup",value:(t=(0,a.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.sceneView,n=this.engine){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.metronome.stop();case 5:n.inputManager.engine=n,n.inputManager.removeListeners(),n.inputManager.removeEventListener(g.ReplayingInputManager.Event.InputEnd,this.onInputEnd),n.inputManager.input="",n.sceneManager.clear(),n.currentWorld=null,n.currentZone=null,n.assets.populate(S.Zone,[]),n.assets.populate(S.Tile,[]),n.assets.populate(S.Puzzle,[]),n.assets.populate(S.Char,[]),n.assets.populate(S.Sound,[]),n.assets=null,n.hero.appearance=null,n.hero=null,n.inputManager.engine=null,n.inputManager=null,n.metronome.onrender=function(){},n.metronome.ontick=function(){},n.metronome=null,n.palette=null,n.renderer=null,n.sceneManager.engine=null,n.sceneManager=null,n.story=null,t.remove(),this.engine=null,this.inputManager=null,this.onInputEnd=null,this.sceneView=null;case 35:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();t.default=W},80485:(e,t,n)=>{"use strict";var i=n(38468)(n(68748));(0,i.default)(t,"__esModule",{value:!0}),t.HealthIsExpectation=t.CurrentZoneIsExpectation=t.ZoneSolvedExpectation=t.UnknownExpectation=t.StorySolvedExpectation=t.Serializer=t.Parser=t.NOPExpectation=t.InventoryContainsExpectation=t.GameplayContext=void 0;var r=n(60309);(0,i.default)(t,"InventoryContainsExpectation",{enumerable:!0,get:function(){return r.InventoryContainsExpectation}}),(0,i.default)(t,"NOPExpectation",{enumerable:!0,get:function(){return r.NOPExpectation}}),(0,i.default)(t,"UnknownExpectation",{enumerable:!0,get:function(){return r.UnknownExpectation}}),(0,i.default)(t,"ZoneSolvedExpectation",{enumerable:!0,get:function(){return r.ZoneSolvedExpectation}}),(0,i.default)(t,"StorySolvedExpectation",{enumerable:!0,get:function(){return r.StorySolvedExpectation}}),(0,i.default)(t,"CurrentZoneIsExpectation",{enumerable:!0,get:function(){return r.CurrentZoneIsExpectation}}),(0,i.default)(t,"HealthIsExpectation",{enumerable:!0,get:function(){return r.HealthIsExpectation}});var a=n(42569);t.Parser=a.default;var o=n(4671);t.GameplayContext=o.default;var u=n(89338);t.Serializer=u.default},42569:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(63789)),a=i(n(25867)),o=i(n(76108)),u=i(n(40361)),s=i(n(7583)),l=i(n(68748)),c=i(n(55933)),d=i(n(20794)),f=i(n(35983)),h=i(n(68190)),p=i(n(92915)),v=i(n(36029)),m=i(n(67093));(0,l.default)(t,"__esModule",{value:!0});var g=n(60309),y=n(78256),_=n(17766),k=[g.StorySolvedExpectation,g.ZoneSolvedExpectation,g.NOPExpectation,g.InventoryContainsExpectation,g.InventoryContainsNotExpectation,g.CurrentZoneIsExpectation,g.TicksExpectation,g.HealthIsExpectation],b=function(){function e(){(0,u.default)(this,e)}var t;return(0,s.default)(e,[{key:"parse",value:function(e,t){for(var n=this.doParse(t),i=0;i<n.length;i++){var r=n[i];r.description||(r.description=e+(n.length>1?" Test ".concat(i+1):""))}return n}},{key:"parseFile",value:(t=(0,o.default)(r.default.mark((function e(t){var n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getFixtureData(t);case 2:return n=e.sent.readString(),e.abrupt("return",this.parse(t,n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"doParse",value:function(e){for(var t,n=(0,c.default)(t=e.split("\n")).call(t),i=[],r=function(){for(;;){var e=n.next();if(e.done)return!1;var t=e.value;if((0,d.default)(t).call(t,"-")&&t.contains("WebFun Test"))return!0}};r();)i.push({configuration:this.parseConfiguration(n),input:this.parseInput(n),expectations:this.parseExpectations(n)});return i}},{key:"parseConfiguration",value:function(e){for(var t={zone:-1,findItem:-1,requiredItem1:-1,requiredItem2:-1,npc:-1,seed:-1,inventory:[],planet:-1,size:-1,tags:[],difficulty:0,health:768};;){var n,i,r,o,u,s,l,c,m,g=e.next();if(g.done)throw"Unexpected end of input";if(g.value.length){if((0,d.default)(n=g.value).call(n,"-"))break;if(!(0,d.default)(i=g.value).call(i,"#")){var y=(0,f.default)(r=(0,h.default)(o=g.value.split(":")).call(o,(function(e){return e.length}))).call(r,(function(e){return e.toLowerCase()})),_=(0,a.default)(y),k=_[0],b=(0,p.default)(_).call(_,1),w=(0,f.default)(u=b.join(":").split(" ")).call(u,(function(e){var t;return(0,v.default)(t=e.toLowerCase()).call(t)})).join("");k.contains("zone")&&(t.zone=w.parseInt()),k.contains("seed")&&(t.seed=w.parseInt()),k.contains("planet")&&(t.planet=this.parsePlanet(w)),k.contains("size")&&(t.size=this.parseWorldSize(w)),k.contains("games won")&&(t.gamesWon=w.parseInt()),k.contains("find")&&(t.findItem=w.parseInt()),k.contains("puzzle")&&(t.npc=w.parseInt()),k.contains("difficulty")&&(t.difficulty=w.toLowerCase().contains("easy")?0:w.toLowerCase().contains("medium")?50:100),k.contains("health")&&(t.health=w.parseInt()),k.contains("require")&&t.requiredItem1>=0&&(t.requiredItem2=w.parseInt()),k.contains("require")&&t.requiredItem1<0&&(t.requiredItem1=w.parseInt()),k.contains("inventory")&&(t.inventory=(0,f.default)(s=w.split(",")).call(s,(function(e){return(0,v.default)(e).call(e).parseInt()}))),k.contains("tag")&&(t.tags=(0,h.default)(l=(0,f.default)(c=g.value.split(":").rest().join(":").split(",")).call(c,(function(e){return(0,v.default)(e).call(e)}))).call(l,(function(e){return e.length}))),k.contains("description")&&(t.description=(0,v.default)(m=g.value.split(":").rest().join(":")).call(m))}}}return t}},{key:"parsePlanet",value:function(e){switch(e){case"tatooine":return _.Zone.Planet.Tatooine.rawValue;case"endor":return _.Zone.Planet.Endor.rawValue;case"hoth":return _.Zone.Planet.Hoth.rawValue}}},{key:"parseWorldSize",value:function(e){switch(e){case"small":return y.WorldSize.Small.rawValue;case"medium":return y.WorldSize.Medium.rawValue;case"large":return y.WorldSize.Large.rawValue}}},{key:"parseInput",value:function(e){for(var t=[];;){var n=e.next();if(n.done)throw"Unexpected end of input";if(n.value.length){if("-"===n.value[0])return(0,f.default)(t).call(t,(function(e){return(0,v.default)(e).call(e)})).join("\n");t.push(n.value)}}}},{key:"parseExpectations",value:function(e){for(var t=[],n=function(){var n,i,r=e.next();if(r.done)return"break";if(!r.value.length)return"continue";if((0,d.default)(n=r.value).call(n,"#"))return"continue";if((0,d.default)(i=r.value).call(i,"-"))return"break";var a=r.value.toLowerCase(),o=(0,m.default)(k).call(k,(function(e){return e.CanBeBuiltFrom(a)}))||g.UnknownExpectation;t.push(o.BuildFrom(r))};;){var i=n();if("break"===i)break}return t}}],[{key:"Parse",value:function(t,n){return(new e).parse(t,n)}}]),e}();t.default=b},89338:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(61822)),a=i(n(40361)),o=i(n(7583)),u=i(n(68748)),s=i(n(35983)),l=i(n(47053));(0,u.default)(t,"__esModule",{value:!0});var c=n(78256),d=n(17766),f=function(){function e(){(0,a.default)(this,e)}return(0,o.default)(e,[{key:"serialize",value:function(e,t,n){var i,a=e.size,o=e.seed,u=e.planet,f=e.zone,h=e.findItem,p=e.npc,v=e.requiredItem1,m=e.requiredItem2,g=e.gamesWon,y=e.description,_=e.tags,k=e.inventory,b=e.difficulty,w=e.health,S=[];return y&&S.push("Description: ".concat(y)),_&&_.length&&S.push("Tag: ".concat(_.join(", "))),(y||_&&_.length)&&S.push(""),o>=0&&S.push("Seed: ".concat(o.toHex(3))),u>0&&S.push("Planet: ".concat(d.Zone.Planet.fromNumber(u).name)),a>0&&S.push("Size: ".concat(c.WorldSize.fromNumber(a).name)),g>0&&S.push("Games Won: ".concat(g.toString(10))),50!==b&&S.push("Difficulty: ".concat(b<50?"easy":"hard")),w&&S.push("Health: ".concat(w)),f>=0&&S.push("Zone: ".concat(f.toHex(3))),h>0&&S.push("Find: ".concat(h.toHex(3))),p>0&&S.push("NPC: ".concat(h.toHex(3))),v>0&&S.push("Required: ".concat(v.toHex(3))),m>0&&S.push("Required: ".concat(m.toHex(3))),k.length&&S.push("Inventory: ".concat((0,s.default)(k).call(k,(function(e){return e.toHex(3)})).join(", "))),(0,l.default)(i=["-= WebFun Test =--"]).call(i,S,["","- Input -",t,"","- Expect -"],(0,r.default)((0,s.default)(n).call(n,(function(e){return e.format()}))),[""]).join("\n")}}]),e}();t.default=f},3185:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244)),c=r(n(68748)),d=r(n(95753)),f=r(n(42601)),h=r(n(20794));function p(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,c.default)(t,"__esModule",{value:!0}),t.Events=void 0;var v=n(31560),m=n(40136);t.Events={DidAddBreakpoint:"DidAddBreakpoint",DidRemoveBreakpoint:"DidRemoveBreakpoint"};var g="breakpoints",y=function(e){(0,u.default)(i,e);var n=p(i);function i(){var e;return(0,a.default)(this,i),(e=n.call(this))._breakpoints={},e._backend=new v.DiscardingStorage,e.registerEvents(t.Events),e._load(),e}return(0,o.default)(i,[{key:"addBreakpoint",value:function(e){this._breakpoints[e.id]=e,this._store(),this.dispatchEvent(new CustomEvent(t.Events.DidAddBreakpoint,{detail:{breakpoint:e}}))}},{key:"hasBreakpoint",value:function(e){return!!this.getBreakpoint(e)}},{key:"getBreakpoint",value:function(e){return this._breakpoints[e]}},{key:"removeBreakpoint",value:function(e){delete this._breakpoints[e.id],this._store(),this.dispatchEvent(new CustomEvent(t.Events.DidRemoveBreakpoint,{detail:{breakpoint:e}}))}},{key:"_store",value:function(){this._backend.setItem(g,(0,d.default)(this._breakpoints).join(","))}},{key:"_load",value:function(){var e=this,t=this._backend.getItem(g);if(t)try{var n;(0,f.default)(n=t.split(",")).call(n,(function(t){var n=null;if((0,h.default)(t).call(t,"@")){var i=t.substr(1).split(":");if(void 0!==i[2]&&"c"!==i[2]&&"i"!==i[2])return void console.warn("Unable to restore breakpoint ".concat(t));n=new m.LocationBreakpoint(+i[0],+i[1],"c"===i[2]?"c":"i"===i[2]?"i":null,void 0!==i[3]?+i[3]:null)}else if((0,h.default)(t).call(t,"SYM:")){var r=t.substr(4).split(":");n=new m.SymbolicBreakpoint(r[0],r[1])}n.id!==t?console.warn("Unable to restore breakpoint ".concat(t)):e._breakpoints[t]=n}))}catch(e){console.warn("Unable to deserialize breakpoints! ".concat(e))}}},{key:"backend",get:function(){return this._backend},set:function(e){this._backend=e,this._load()}}]),i}(v.EventTarget);y.Event=t.Events,t.default=y},27248:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(40361));(0,i(n(68748)).default)(t,"__esModule",{value:!0});t.default=function e(){(0,r.default)(this,e)}},40136:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0}),t.SymbolicBreakpoint=t.LocationBreakpoint=t.Breakpoint=void 0;var i=n(27248);t.Breakpoint=i.default;var r=n(38704);t.LocationBreakpoint=r.default;var a=n(50070);t.SymbolicBreakpoint=a.default},38704:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244));function c(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0});var d=function(e){(0,u.default)(n,e);var t=c(n);function n(e,i){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,a.default)(this,n),(r=t.call(this))._path=[e,i],null!==o&&r._path.push(o),null!==u&&r._path.push(u),r}return(0,o.default)(n,[{key:"id",get:function(){return"@".concat(this._path.join(":"))}}]),n}(n(27248).default);t.default=d},50070:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244)),c=r(n(68748)),d=r(n(47053));function f(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,c.default)(t,"__esModule",{value:!0});var h=function(e){(0,u.default)(n,e);var t=f(n);function n(e,i){var r;return(0,a.default)(this,n),(r=t.call(this))._symbolType=e,r._symbol=i,r}return(0,o.default)(n,[{key:"id",get:function(){var e;return(0,d.default)(e="SYM:".concat(this._symbolType,":")).call(e,this._symbol)}}]),n}(n(27248).default);t.default=h},6497:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244));function c(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(65308);var d=n(84776),f=n(31560),h=n(78160),p=function(e){(0,u.default)(n,e);var t=c(n);function n(){return(0,a.default)(this,n),t.apply(this,arguments)}return(0,o.default)(n,[{key:"draw",value:function(){if(this.palette){var e=this._canvas.getContext("2d");e.clearRect(0,0,this._canvas.width,this._canvas.height),this._pixels&&this._size&&e.putImageData(h.drawImage(this.pixels,this.size,this.palette),0,0)}}},{key:"size",get:function(){return new f.Size(this._canvas.width,this._canvas.height)},set:function(e){this._canvas.width=e.width,this._canvas.height=e.height}},{key:"pixels",get:function(){return this._pixels},set:function(e){this._pixels=e,this.draw()}}]),n}(d.default);t.default=p},84776:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244));function d(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(41370);var f=function(e){(0,s.default)(n,e);var t=d(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments))._canvas=WebFun.JSX.render("canvas",null),e}return(0,o.default)(n,[{key:"connectedCallback",value:function(){(0,u.default)((0,c.default)(n.prototype),"connectedCallback",this).call(this),this.appendChild(this._canvas)}},{key:"disconnectedCallback",value:function(){this.removeChild(this._canvas),(0,u.default)((0,c.default)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"palette",get:function(){return this._palette},set:function(e){this._palette=e,this.draw()}}]),n}(n(88607).Component);t.default=f},45010:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244));function c(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(18181);var d=n(84776),f=n(17766),h=n(78160),p=function(e){(0,u.default)(n,e);var t=c(n);function n(){var e;return(0,a.default)(this,n),(e=t.call(this))._canvas.width=f.Tile.WIDTH,e._canvas.height=f.Tile.HEIGHT,e}return(0,o.default)(n,[{key:"draw",value:function(){if(this.palette){var e=this._canvas.getContext("2d");e.clearRect(0,0,f.Tile.WIDTH,f.Tile.HEIGHT),this._tile&&e.putImageData(h.drawTileImageData(this._tile,this.palette),0,0)}}},{key:"tile",get:function(){return this._tile},set:function(e){this._tile=e,this.draw()}}]),n}(d.default);t.default=p},99123:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244));function c(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(27101);var d=n(17766),f=n(84776),h=n(78160),p=function(e){(0,u.default)(n,e);var t=c(n);function n(){return(0,a.default)(this,n),t.apply(this,arguments)}return(0,o.default)(n,[{key:"draw",value:function(){if(this.palette){var e=this._canvas.getContext("2d");e.clearRect(0,0,this._canvas.width,this._canvas.height),this._zone&&e.putImageData(h.drawZoneImageData(this._zone,this.palette),0,0)}}},{key:"zone",get:function(){return this._zone},set:function(e){this._zone=e,this._canvas.width=d.Tile.WIDTH*e.size.width,this._canvas.height=d.Tile.HEIGHT*e.size.height,this.draw()}}]),n}(f.default);t.default=p},67551:(e,t,n)=>{"use strict";var i=n(79406),r=n(92915),a=n(69159),o=n(67986),u=n(13037),s=n(29689),l=n(38468),c=l(n(63789)),d=l(n(76108)),f=l(n(40361)),h=l(n(7583)),p=l(n(80655)),v=l(n(20497)),m=l(n(75244)),g=l(n(68748)),y=l(n(42601)),_=l(n(47053)),k=l(n(69159));function b(e,t){var n=void 0!==o&&u(e)||e["@@iterator"];if(!n){if(s(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return w(e,t);var i=r(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return a(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return w(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,l=function(){};return{s:l,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,d=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){f=!0,c=e},f:function(){try{d||null==n.return||n.return()}finally{if(f)throw c}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function S(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,v.default)(this,n)}}(0,g.default)(t,"__esModule",{value:!0}),n(40943);var x=n(82039),C=n(88607),T=n(85827),I=n(45598),E=n(47590),B=n(83608),z=n(97848),W=n(38704),N=function(e){(0,p.default)(i,e);var t,n=S(i);function i(){var e;return(0,f.default)(this,i),(e=n.apply(this,arguments)).zone=null,e.index=null,e.engine=null,e._action=null,e.breakpointStore=null,e}return(0,h.default)(i,[{key:"action",get:function(){return this._action},set:function(e){var t,n,i=this;this._action=e,this.appendChild(WebFun.JSX.render("span",{className:"head"},WebFun.JSX.render("span",{className:"key"},"actn ".concat(e.id)),WebFun.JSX.render(x.default,{store:this.breakpointStore,breakpoint:new W.default(this.zone.id,this.action.id)}))),this.appendChild(document.createTextNode("(")),this._append("and","key"),this.appendChild(document.createTextNode("\t")),(0,y.default)(t=e.conditions).call(t,(function(e,t){0!==t&&i.appendChild(document.createTextNode("\n\t")),i.appendChild(WebFun.JSX.render(I.default,{zone:i.zone,action:i._action,engine:i.engine,breakpointStore:i.breakpointStore,variableMap:i.variableMap,condition:e}))})),this._append(")","paren-close"),this.appendChild(document.createTextNode("\n")),this.appendChild(document.createTextNode("\t(")),this._append("do","key"),(0,y.default)(n=e.instructions).call(n,(function(e){i.appendChild(document.createTextNode("\n\t   ")),i.appendChild(WebFun.JSX.render(z.default,{zone:i.zone,action:i._action,engine:i.engine,variableMap:i.variableMap,breakpointStore:i.breakpointStore,instruction:e}))})),this._append(")","paren-close"),this._append(")","paren-close")}},{key:"current",get:function(){return this.hasAttribute("current")},set:function(e){e?this.setAttribute("current",""):this.removeAttribute("current")}},{key:"_storageId",get:function(){var e;return(0,_.default)(e="debug.action.expanded.".concat(this.zone,".")).call(e,this.index)}},{key:"evaluateConditions",value:(t=(0,d.default)(c.default.mark((function e(){var t,n,i,r,a;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this.checker)||(t=this.checker=new T.default(E.ConditionImplementations,this.engine)),n=(0,k.default)(this.querySelectorAll(I.default.tagName)),i=b(n),e.prev=4,i.s();case 6:if((r=i.n()).done){e.next=17;break}return a=r.value,e.next=10,t.check(a.condition,B.EvaluationMode.Walk,this._action.zone);case 10:if(!e.sent){e.next=14;break}a.setAttribute("truthy",""),e.next=15;break;case 14:a.removeAttribute("truthy");case 15:e.next=6;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(4),i.e(e.t0);case 22:return e.prev=22,i.f(),e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[4,19,22,25]])}))),function(){return t.apply(this,arguments)})},{key:"_append",value:function(e,t){var n=WebFun.JSX.render("span",{className:t});return"string"==typeof e?n.innerText=e:e instanceof Element?n.appendChild(e):(0,y.default)(e).call(e,(function(e){return n.appendChild(e)})),this.appendChild(n),n}}]),i}(C.Component);N.tagName="wf-debug-action",N.observedAttributes=["current"],t.default=N},82039:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244));function c(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),t.Events=void 0,n(31771);var d=n(3185),f=n(88607);t.Events={DidSet:"DidSet",DidUnset:"DidUnset"};var h=function(e){(0,u.default)(n,e);var t=c(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments)).breakpoint=null,e._removeHandler=function(t){return t.detail.breakpoint===e.breakpoint&&(e.active=!1)},e._addHandler=function(t){return t.detail.breakpoint===e.breakpoint&&(e.active=!0)},e}return(0,o.default)(n,[{key:"active",get:function(){return this.hasAttribute("active")},set:function(e){e?this.setAttribute("active",""):this.removeAttribute("active")}},{key:"connectedCallback",value:function(){var e=this;this.onclick=function(){return e.toggle()},this.active=this.store.hasBreakpoint(this.breakpoint.id),this.store.addEventListener(d.default.Event.DidAddBreakpoint,this._addHandler),this.store.addEventListener(d.default.Event.DidRemoveBreakpoint,this._removeHandler)}},{key:"disconnectedCallback",value:function(){this.store.removeEventListener(d.default.Event.DidAddBreakpoint,this._addHandler),this.store.removeEventListener(d.default.Event.DidRemoveBreakpoint,this._removeHandler)}},{key:"toggle",value:function(){this.active=!this.active,this.active?this.store.addBreakpoint(this.breakpoint):this.store.removeBreakpoint(this.breakpoint)}}]),n}(f.Component);h.Event=t.Events,h.tagName="wf-debug-breakpoint-button",h.observedAttributes=["active"],t.default=h},45598:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(94433)),o=r(n(40361)),u=r(n(7583)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244)),d=r(n(68748)),f=r(n(67093)),h=r(n(95753)),p=r(n(75356)),v=r(n(47053));function m(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,d.default)(t,"__esModule",{value:!0});var g=n(82039),y=n(47590),_=n(17399),k=n(38704),b=function(e){(0,s.default)(n,e);var t=m(n);function n(){var e;return(0,o.default)(this,n),(e=t.apply(this,arguments)).engine=null,e.breakpointStore=null,e}return(0,u.default)(n,[{key:"condition",get:function(){return this._condition},set:function(e){this._condition=e,this._rebuild()}},{key:"type",get:function(){return"c"}},{key:"_rebuild",value:function(){var e,t,n=this,i=(0,f.default)(e=(0,h.default)(y.ConditionsByName)).call(e,(function(e){return y.ConditionsByName[e].Opcode===n._condition.opcode})),r=y.ConditionsByName[i];this.textContent="",this.appendChild(this._open()),this.appendChild(this._command(i)),this.customize(r),this.appendChild(this._close()),this.appendChild(WebFun.JSX.render(g.default,{store:this.breakpointStore,breakpoint:new k.default(this.zone.id,this.action.id,"c",(0,p.default)(t=this.action.conditions).call(t,this.condition))}))}},{key:"customize",value:function(e){var t,n;switch(this._condition.opcode){case y.ConditionsByName.ZoneNotInitialized.Opcode:case y.ConditionsByName.ZoneEntered.Opcode:break;case y.ConditionsByName.PlacedItemIs.Opcode:case y.ConditionsByName.PlacedItemIsNot.Opcode:this.appendLocationArgument(this._condition.arguments[0],this._condition.arguments[1],this._condition.arguments[2]),this.appendTileArgument(this._condition.arguments[3]),this.appendTileArgument(this._condition.arguments[4]);break;case y.ConditionsByName.Bump.Opcode:case y.ConditionsByName.StandingOn.Opcode:this.appendLocationArgument(this._condition.arguments[0],this._condition.arguments[1]),this.appendTileArgument(this._condition.arguments[2]);break;case y.ConditionsByName.CounterIs.Opcode:case y.ConditionsByName.RandomIs.Opcode:case y.ConditionsByName.RandomIsGreaterThan.Opcode:case y.ConditionsByName.RandomIsLessThan.Opcode:this.appendNumberArgument(this._condition.arguments[0]);break;case y.ConditionsByName.EnterByPlane.Opcode:break;case y.ConditionsByName.TileAtIs.Opcode:this.appendLocationArgument(this._condition.arguments[1],this._condition.arguments[2],this._condition.arguments[3]),this.appendTileArgument(this._condition.arguments[0]);break;case y.ConditionsByName.MonsterIsDead.Opcode:this.appendNumberArgument(this._condition.arguments[0]);break;case y.ConditionsByName.HasNoActiveMonsters.Opcode:break;case y.ConditionsByName.HasItem.Opcode:case y.ConditionsByName.RequiredItemIs.Opcode:case y.ConditionsByName.EndingIs.Opcode:this.appendTileArgument(this._condition.arguments[0]);break;case y.ConditionsByName.ZoneIsSolved.Opcode:case y.ConditionsByName.Unused.Opcode:break;case y.ConditionsByName.HealthIsLessThan.Opcode:case y.ConditionsByName.HealthIsGreaterThan.Opcode:this.appendNumberArgument(this._condition.arguments[0]);break;case y.ConditionsByName.FindItemIs.Opcode:this.appendTileArgument(this._condition.arguments[0]);break;case y.ConditionsByName.HeroIsAt.Opcode:this.appendLocationArgument(this._condition.arguments[0],this._condition.arguments[1]);break;case y.ConditionsByName.SectorCounterIs.Opcode:case y.ConditionsByName.SectorCounterIsLessThan.Opcode:case y.ConditionsByName.SectorCounterIsGreaterThan.Opcode:case y.ConditionsByName.GamesWonIs.Opcode:this.appendNumberArgument(this._condition.arguments[0]);break;case y.ConditionsByName.DropsQuestItemAt.Opcode:this.appendLocationArgument(this._condition.arguments[0],this._condition.arguments[1]);break;case y.ConditionsByName.HasAnyRequiredItem.Opcode:break;case y.ConditionsByName.CounterIsNot.Opcode:case y.ConditionsByName.RandomIsNot.Opcode:case y.ConditionsByName.SectorCounterIsNot.Opcode:this.appendNumberArgument(this._condition.arguments[0]);break;case y.ConditionsByName.IsVariable.Opcode:var i=(0,a.default)(this._condition.arguments,4),r=i[0],o=i[1],u=i[2],s=i[3],l=(0,v.default)(t=(0,v.default)(n="".concat(o.toString(),"x")).call(n,u.toString(),"x")).call(t,s.toString());this.appendChild(WebFun.JSX.render("span",{className:"argument variable"},this.variableMap[l].toString())),this.appendChild(WebFun.JSX.render("span",{className:"argument number"},r.toString()));break;case y.ConditionsByName.GamesWonIsGreaterThan.Opcode:this.appendNumberArgument(this._condition.arguments[0])}}}]),n}(_.default);b.tagName="wf-debug-condition",t.default=b},22921:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244));function c(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(4397);var d=n(88607),f=n(5008),h=function(e){(0,u.default)(n,e);var t=c(n);function n(){var e;return(0,a.default)(this,n),(e=t.call(this)).ontogglepause=function(){},e.onstep=function(){},e.ondraw=function(){},e.onfastforward=function(){},e._stepButton=WebFun.JSX.render(f.IconButton,{icon:"step-forward",onclick:function(){return e.onstep()}}),e._fastForwardButton=WebFun.JSX.render(f.IconButton,{icon:"fast-forward",onclick:function(){return e.onfastforward()}}),e._playButton=WebFun.JSX.render(f.IconButton,{icon:"play",onclick:function(){return e.ontogglepause()}}),e}return(0,o.default)(n,[{key:"running",get:function(){return this.hasAttribute("running")},set:function(e){e?this.setAttribute("running",""):this.removeAttribute("running")}},{key:"connectedCallback",value:function(){this.appendChild(this._playButton),this.appendChild(this._stepButton),this.appendChild(this._fastForwardButton)}},{key:"attributeChangedCallback",value:function(e){if("running"===e){var t=this.hasAttribute("running");this._playButton.icon=t?"pause":"play",this._stepButton.disabled=t,this._fastForwardButton.disabled=t}}}]),n}(d.Component);h.tagName="wf-debug-controls",h.observedAttributes=["running"],t.default=h},28885:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244)),d=r(n(68748)),f=r(n(42601));function h(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,d.default)(t,"__esModule",{value:!0});var p=n(88607);n(89566);var v=function(e){(0,s.default)(n,e);var t=h(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments))._expectations=[],e._engine=null,e}return(0,o.default)(n,[{key:"connectedCallback",value:function(){(0,u.default)((0,c.default)(n.prototype),"connectedCallback",this).call(this),this.rebuild()}},{key:"rebuild",value:function(){var e,t=this;this.textContent="",(0,f.default)(e=this.expectations).call(e,(function(e){t.appendChild(WebFun.JSX.render("div",null,t.buildStatus(e)," ",e.format()))}))}},{key:"buildStatus",value:function(e){if(!this.engine)return WebFun.JSX.render("span",null,"⚪️");try{return this.evaluate(e),WebFun.JSX.render("span",null,"🟢")}catch(e){return WebFun.JSX.render("span",{title:e},"🔴")}}},{key:"evaluate",value:function(e){var t=function(e){throw e},n=function(e){return e||t("")};window.it=function(e,t){return t()},window.expect=function(e){return{toBe:function(t){return n(e===t)},toEqual:function(t){return n(e===t)},toBeTrue:function(){return n(!0===e)},toBeFalse:function(){return n(!1===e)},toBeTruthy:function(){return n(!!e)},toBeFalsy:function(){return n(!e)}}},window.fail=t,e.evaluate({engine:this.engine}),delete window.expect,delete window.it,delete window.fail}},{key:"evaluateExpectations",value:function(){for(var e=0;e<this.expectations.length;e++){var t=this.children[e],n=this.expectations[e];t.replaceChild(this.buildStatus(n),t.firstElementChild)}}},{key:"expectations",get:function(){return this._expectations},set:function(e){this._expectations=null!=e?e:[],this.rebuild()}},{key:"engine",get:function(){return this._engine},set:function(e){this._engine=e,this.rebuild()}}]),n}(p.Component);v.tagName="wf-debug-expectation-editor",t.default=v},7872:(e,t,n)=>{"use strict";var i=n(38468)(n(68748));(0,i.default)(t,"__esModule",{value:!0}),t.ZoneView=t.ZonePickerCell=t.ZonePicker=t.WorldConfigurationBuilder=t.TileView=t.TileCell=t.TestCreatorWindow=t.SimulationConfigurationBuilder=t.PopoverZonePicker=t.PaletteImageView=t.Instruction=t.ExpectationEditor=t.Controls=t.ConfigurationBuilder=t.Condition=t.BreakpointButton=t.Action=t.AbstractZoneView=t.AbstractTileView=t.AbstractPaletteView=t.AbstractPaletteImageView=void 0;var r=n(67551);t.Action=r.default;var a=n(82039);t.BreakpointButton=a.default;var o=n(45598);t.Condition=o.default;var u=n(22921);t.Controls=u.default;var s=n(97848);t.Instruction=s.default;var l=n(42169);t.TileCell=l.default;var c=n(9779);(0,i.default)(t,"TestCreatorWindow",{enumerable:!0,get:function(){return c.TestCreatorWindow}}),(0,i.default)(t,"ConfigurationBuilder",{enumerable:!0,get:function(){return c.ConfigurationBuilder}}),(0,i.default)(t,"SimulationConfigurationBuilder",{enumerable:!0,get:function(){return c.SimulationConfigurationBuilder}}),(0,i.default)(t,"WorldConfigurationBuilder",{enumerable:!0,get:function(){return c.WorldConfigurationBuilder}});var d=n(6497);t.AbstractPaletteImageView=d.default;var f=n(84776);t.AbstractPaletteView=f.default;var h=n(45010);t.AbstractTileView=h.default;var p=n(99123);t.AbstractZoneView=p.default;var v=n(28885);t.ExpectationEditor=v.default;var m=n(56974);t.PaletteImageView=m.default;var g=n(99465);t.PopoverZonePicker=g.default;var y=n(79586);t.TileView=y.default;var _=n(35896);t.ZonePicker=_.default;var k=n(74999);t.ZonePickerCell=k.default;var b=n(63054);t.ZoneView=b.default},17399:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(80655)),s=r(n(20497)),l=r(n(75244));function c(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0});var d=n(88607),f=n(79586),h=n(17766),p=n(92540),v=function(e){(0,u.default)(n,e);var t=c(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments)).zone=null,e.action=null,e.index=null,e.engine=null,e.variableMap=null,e}return(0,o.default)(n,[{key:"current",get:function(){return this.hasAttribute("current")},set:function(e){e?this.setAttribute("current",""):this.removeAttribute("current")}},{key:"_open",value:function(){return this._paren("open")}},{key:"_command",value:function(e){return WebFun.JSX.render("span",{className:"command"},e.dasherize())}},{key:"_close",value:function(){return this._paren("close")}},{key:"_paren",value:function(e){return WebFun.JSX.render("span",{className:"close"===e?"paren-close":"paren-open"},"open"===e?"(":")")}},{key:"appendNumberArgument",value:function(e){this.appendChild(WebFun.JSX.render("span",{className:"argument number"},e.toString()))}},{key:"appendTileArgument",value:function(e){this.appendChild(WebFun.JSX.render("span",{className:"argument tile"},WebFun.JSX.render(f.default,{palette:this.engine.palette.original,tile:this.engine.assets.get(h.Tile,e,p.NullIfMissing),style:{zoom:"0.4",transform:"translateY(8.9px)",display:"inline-block"}})))}},{key:"appendLocationArgument",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.appendChild(WebFun.JSX.render("span",{className:"argument location"},e.toString(),"x",t.toString(),null!==n?"x".concat(n.toString()):""))}}],[{key:"observedAttributes",get:function(){return["current"]}}]),n}(d.Component);t.default=v},97848:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(94433)),o=r(n(40361)),u=r(n(7583)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244)),d=r(n(68748)),f=r(n(67093)),h=r(n(95753)),p=r(n(75356)),v=r(n(47053));function m(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,d.default)(t,"__esModule",{value:!0});var g=n(82039),y=n(17766),_=n(17399),k=n(35288),b=n(38704),w=function(e){(0,s.default)(n,e);var t=m(n);function n(){var e;return(0,o.default)(this,n),(e=t.apply(this,arguments)).breakpointStore=null,e}return(0,u.default)(n,[{key:"instruction",get:function(){return this._instruction},set:function(e){this._instruction=e,this._rebuild()}},{key:"type",get:function(){return"i"}},{key:"_rebuild",value:function(){var e,t,n=this,i=(0,f.default)(e=(0,h.default)(k.InstructionsByName)).call(e,(function(e){return k.InstructionsByName[e].Opcode===n._instruction.opcode})),r=k.InstructionsByName[i];this.textContent="",this.appendChild(this._open()),this.appendChild(this._command(i)),this.customize(r),this.appendChild(this._close()),this.appendChild(WebFun.JSX.render(g.default,{store:this.breakpointStore,breakpoint:new b.default(this.zone.id,this.action.id,"i",(0,p.default)(t=this.action.instructions).call(t,this.instruction))}))}},{key:"customize",value:function(e){var t,n;switch(this._instruction.opcode){case k.InstructionsByName.PlaceTile.Opcode:this.appendLocationArgument(this._instruction.arguments[0],this._instruction.arguments[1],this._instruction.arguments[2]),this.appendTileArgument(this._instruction.arguments[3]);break;case k.InstructionsByName.RemoveTile.Opcode:this.appendLocationArgument(this._instruction.arguments[0],this._instruction.arguments[1],this._instruction.arguments[2]);break;case k.InstructionsByName.MoveTile.Opcode:this.appendLocationArgument(this._instruction.arguments[0],this._instruction.arguments[1],this._instruction.arguments[2]),this.appendLocationArgument(this._instruction.arguments[3],this._instruction.arguments[4],this._instruction.arguments[2]);break;case k.InstructionsByName.DrawTile.Opcode:this.appendLocationArgument(this._instruction.arguments[3],this._instruction.arguments[4],this._instruction.arguments[2]);break;case k.InstructionsByName.SpeakHero.Opcode:this.appendTextArgument(this._instruction.text);break;case k.InstructionsByName.SpeakNpc.Opcode:this.appendLocationArgument(this._instruction.arguments[0],this._instruction.arguments[1]),this.appendTextArgument(this._instruction.text);break;case k.InstructionsByName.EnableMonster.Opcode:case k.InstructionsByName.DisableMonster.Opcode:this.appendNumberArgument(this._instruction.arguments[0]);break;case k.InstructionsByName.EnableAllMonsters.Opcode:case k.InstructionsByName.DisableAllMonsters.Opcode:case k.InstructionsByName.SetTileNeedsDisplay.Opcode:case k.InstructionsByName.SetRectNeedsDisplay.Opcode:case k.InstructionsByName.Wait.Opcode:case k.InstructionsByName.Redraw.Opcode:break;case k.InstructionsByName.PlaySound.Opcode:this.appendSoundArgument(this._instruction.arguments[0]);break;case k.InstructionsByName.StopSound.Opcode:break;case k.InstructionsByName.RollDice.Opcode:case k.InstructionsByName.SetCounter.Opcode:this.appendNumberArgument(this._instruction.arguments[0]);break;case k.InstructionsByName.SetVariable.Opcode:var i=(0,a.default)(this._instruction.arguments,4),r=i[0],o=i[1],u=i[2],s=i[3],l=(0,v.default)(t=(0,v.default)(n="".concat(r.toString(),"x")).call(n,o.toString(),"x")).call(t,u.toString());this.appendChild(WebFun.JSX.render("span",{className:"argument variable"},this.variableMap[l].toString())),this.appendChild(WebFun.JSX.render("span",{className:"argument number"},s.toString()));break;case k.InstructionsByName.HideHero.Opcode:case k.InstructionsByName.ShowHero.Opcode:break;case k.InstructionsByName.MoveHeroTo.Opcode:this.appendLocationArgument(this._instruction.arguments[0],this._instruction.arguments[1]);break;case k.InstructionsByName.DisableAction.Opcode:break;case k.InstructionsByName.DisableHotspot.Opcode:case k.InstructionsByName.EnableHotspot.Opcode:this.appendNumberArgument(this._instruction.arguments[0]);break;case k.InstructionsByName.DropItem.Opcode:this.appendTileArgument(this._instruction.arguments[0]),this.appendLocationArgument(this._instruction.arguments[1],this._instruction.arguments[2]);break;case k.InstructionsByName.AddItem.Opcode:case k.InstructionsByName.RemoveItem.Opcode:this.appendTileArgument(this._instruction.arguments[0]);break;case k.InstructionsByName.ChangeZone.Opcode:break;case k.InstructionsByName.SetSectorCounter.Opcode:case k.InstructionsByName.AddToSectorCounter.Opcode:case k.InstructionsByName.SetRandom.Opcode:case k.InstructionsByName.AddHealth.Opcode:case k.InstructionsByName.AddToCounter.Opcode:this.appendNumberArgument(this._instruction.arguments[0]);break;case k.InstructionsByName.WinGame.Opcode:case k.InstructionsByName.LoseGame.Opcode:case k.InstructionsByName.MarkAsSolved.Opcode:break;case k.InstructionsByName.MoveHeroBy.Opcode:this.appendLocationArgument(this._instruction.arguments[0],this._instruction.arguments[1])}}},{key:"appendTextArgument",value:function(e){this.appendChild(WebFun.JSX.render("span",{className:"argument text",title:e},"text"))}},{key:"appendSoundArgument",value:function(e){this.appendChild(WebFun.JSX.render("span",{className:"argument sound"},this.engine.assets.get(y.Sound,e).file))}}]),n}(_.default);w.tagName="wf-debug-instruction",t.default=w},56974:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(80655)),u=r(n(20497)),s=r(n(75244));function l(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var a=(0,s.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(56974);var c=function(e){(0,o.default)(n,e);var t=l(n);function n(){return(0,a.default)(this,n),t.apply(this,arguments)}return n}(n(6497).default);c.tagName="wf-debug-palette-image-view",t.default=c},99465:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244)),d=r(n(68748)),f=r(n(68190));function h(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,d.default)(t,"__esModule",{value:!0}),n(51839);var p=n(17766),v=n(35896),m=n(88607),g=n(31560),y=n(5008),_=n(48387),k=n(78160),b=function(e){(0,s.default)(n,e);var t=h(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments))._canvas=WebFun.JSX.render("canvas",null),e.filter=null,e._state=new g.DiscardingStorage,e}return(0,o.default)(n,[{key:"connectedCallback",value:function(){(0,u.default)((0,c.default)(n.prototype),"connectedCallback",this).call(this),this.appendChild(this._canvas),this.addEventListener("click",this)}},{key:"handleEvent",value:function(e){var t=this;if(!this.disabled){var n=this.getBoundingClientRect(),i=n.left,r=n.top,a=WebFun.JSX.render(y.Popover,{style:{position:"absolute",left:"".concat(i.toString(),"px"),top:"".concat(r.toString(),"px")}}),o=new _.PopoverModalSession(a),u=WebFun.JSX.render(v.default,{zones:this.filteredZones,palette:this.palette,zone:this.zone,style:{width:"258px",height:"400px"},state:this.state});u.addEventListener(v.Events.ZoneDidChange,(function(e){t.pickerOnChange(u,e),o.end(1)})),o.onclick=function(e){return!e.target.closest(y.Popover.tagName)&&o.end(0)},a.content.appendChild(u),o.run(),u.focus(),e.stopPropagation()}}},{key:"pickerOnChange",value:function(e,t){this.zone=t.detail.zone,this.dispatchEvent(new CustomEvent("change",{detail:{zone:this.zone},bubbles:!0}))}},{key:"disconnectedCallback",value:function(){this._canvas.remove(),this.removeEventListener("click",this),(0,u.default)((0,c.default)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"redraw",value:function(){if(this._zone&&this._palette){var e=this._zone.size.width*p.Tile.WIDTH,t=this._zone.size.height*p.Tile.HEIGHT;this._canvas.setAttribute("width","".concat(e)),this._canvas.setAttribute("height","".concat(t));var n=this._canvas.getContext("2d");n.fillStyle="#000",n.fillRect(0,0,e,t);var i=k.drawZoneImageData(this._zone,this._palette);n.putImageData(i,0,0)}}},{key:"state",get:function(){return this._state},set:function(e){this._state=e;var t=this.zones[this.state.load("zone")];t&&(this.zone=t)}},{key:"palette",get:function(){return this._palette},set:function(e){this._palette=e,this.redraw()}},{key:"zone",get:function(){return this._zone},set:function(e){this._zone=e,this.state.store("zone",e?e.id:null),this.redraw()}},{key:"filteredZones",get:function(){var e,t=this;return(0,f.default)(this)?(0,f.default)(e=this.zones).call(e,(function(e){return(0,f.default)(t).call(t,e)})):this.zones}},{key:"disabled",get:function(){return this.hasAttribute("disabled")},set:function(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}}]),n}(m.Component);b.tagName="wf-debug-popover-zone-picker",t.default=b},28325:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(68748)),a=i(n(68190)),o=i(n(92915));(0,r.default)(t,"__esModule",{value:!0});var u=n(31560),s=n(17766);t.default=function(e,t){var n;return u.srand(e.id),(0,a.default)(n=(0,o.default)(t).call(t)).call(n,(function(t){return t!==e&&t.type===s.Zone.Type.Empty&&t.planet===e.planet})).shuffle()}},54319:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244)),d=r(n(68748)),f=r(n(42601));function h(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,d.default)(t,"__esModule",{value:!0}),n(17602);var p=n(88607),v=n(31560),m=n(5008),g=n(28869),y=n(33627),_=function(e){(0,s.default)(n,e);var t=h(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments))._state=new v.DiscardingStorage,e._simulationConfigurationBuilder=WebFun.JSX.render(g.default,null),e._worldConfigurationBuilder=WebFun.JSX.render(y.default,null),e}return(0,o.default)(n,[{key:"connectedCallback",value:function(){var e,t=this;(0,u.default)((0,c.default)(n.prototype),"connectedCallback",this).call(this);var i=null!==(e=this._initialConfiguration)&&void 0!==e?e:{inventory:[],tags:[],seed:0,difficulty:50};this.append.apply(this,[WebFun.JSX.render(m.SegmentControl,{onsegmentchange:function(e){var n;(0,f.default)(n=t.querySelectorAll("#world,#simulation")).call(n,(function(e){return e.style.display="none"})),t.querySelector("#"+e.className).style.display=""},state:this._state.prefixedWith("selector")},WebFun.JSX.render(m.Segment,{className:"world",selected:i.zone<0},"New World"),WebFun.JSX.render(m.Segment,{className:"simulation",selected:i.zone>=0},"Simulation")),WebFun.JSX.render("div",{id:"world"},this._worldConfigurationBuilder),WebFun.JSX.render("div",{id:"simulation"},this._simulationConfigurationBuilder)]),this._initialConfiguration&&(this.configuration=i)}},{key:"disconnectedCallback",value:function(){this.textContent="",(0,u.default)((0,c.default)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"configuration",get:function(){return this.currentBuilder.configuration},set:function(e){this._simulationConfigurationBuilder.configuration=e,this._worldConfigurationBuilder.configuration=e,this._initialConfiguration=e,this.isConnected&&(e.zone>=0?(this._worldConfigurationBuilder.parentElement.style.display="none",this._simulationConfigurationBuilder.parentElement.style.display=""):(this._worldConfigurationBuilder.parentElement.style.display="",this._simulationConfigurationBuilder.parentElement.style.display="none"))}},{key:"currentBuilder",get:function(){return"none"===this._simulationConfigurationBuilder.parentElement.style.display?this._worldConfigurationBuilder:this._simulationConfigurationBuilder}},{key:"gameData",get:function(){return this._simulationConfigurationBuilder.gameData},set:function(e){this._simulationConfigurationBuilder.gameData=e}},{key:"palette",get:function(){return this._simulationConfigurationBuilder.palette},set:function(e){this._simulationConfigurationBuilder.palette=e}},{key:"state",get:function(){return this._state},set:function(e){this._state=e,this._simulationConfigurationBuilder.state=e.prefixedWith("simulation"),this._worldConfigurationBuilder.state=e.prefixedWith("world");var t=this.querySelector(m.SegmentControl.tagName);t&&(t.state=e.prefixedWith("selector"))}}]),n}(p.Component);_.tagName="wf-debug-test-creator-configuration-builder",t.default=_},9779:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0}),t.WorldConfigurationBuilder=t.SimulationConfigurationBuilder=t.ConfigurationBuilder=t.TestCreatorWindow=void 0;var i=n(87661);t.TestCreatorWindow=i.default;var r=n(54319);t.ConfigurationBuilder=r.default;var a=n(28869);t.SimulationConfigurationBuilder=a.default;var o=n(33627);t.WorldConfigurationBuilder=o.default},28869:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(61822)),o=r(n(40361)),u=r(n(7583)),s=r(n(18582)),l=r(n(80655)),c=r(n(20497)),d=r(n(75244)),f=r(n(68748)),h=r(n(47053)),p=r(n(35983)),v=r(n(42601)),m=r(n(68190));function g(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,c.default)(this,n)}}(0,f.default)(t,"__esModule",{value:!0}),n(3347);var y=n(88607),_=n(31560),k=n(99670),b=n(99465),w=n(28801),S=n(17766),x=n(28325),C=function(e){(0,l.default)(n,e);var t=g(n);function n(){var e;return(0,o.default)(this,n),(e=t.apply(this,arguments))._gameData=null,e._state=new _.DiscardingStorage,e._mainPicker=WebFun.JSX.render(b.default,{filter:w.default,onchange:function(t){var n=t.detail.zone;return e.currentZone=n}}),e._zonePickers=8..times((function(){return WebFun.JSX.render(b.default,{filter:function(t){var n=t.type,i=t.planet;return n===S.Zone.Type.Empty&&i===e.currentZone.planet},disabled:!0})})),e._findTile=WebFun.JSX.render(k.PopoverTilePicker,{title:"Item to find"}),e._npcTile=WebFun.JSX.render(k.PopoverTilePicker,{title:"Npc involved in trade"}),e._requiredTile=WebFun.JSX.render(k.PopoverTilePicker,{title:"Item required to solve puzzle"}),e._required2Tile=WebFun.JSX.render(k.PopoverTilePicker,{title:"Item required to solve goal"}),e._inventory=[],e}return(0,u.default)(n,[{key:"connectedCallback",value:function(){(0,s.default)((0,d.default)(n.prototype),"connectedCallback",this).call(this),this.appendChild(WebFun.JSX.render("div",{className:"zone-container"},this._zonePickers[0],this._zonePickers[1],this._zonePickers[2],this._zonePickers[3],this._mainPicker,this._zonePickers[4],this._zonePickers[5],this._zonePickers[6],this._zonePickers[7])),this.appendChild(WebFun.JSX.render("div",{className:"tile-container"},this._requiredTile,this._required2Tile,this._findTile,this._npcTile))}},{key:"disconnectedCallback",value:function(){this.textContent="",(0,s.default)((0,d.default)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"currentZone",get:function(){return this._mainPicker.zone||this._gameData.zones[0]},set:function(e){var t,n,i,r,o,u=this.connectedZones(e);this._mainPicker.zone=e,this._findTile.tiles=(0,h.default)(t=e.providedItems).apply(t,(0,a.default)((0,p.default)(u).call(u,(function(e){return e.providedItems})))).unique(),this._findTile.tile=this._findTile.tiles.first(),this._npcTile.tiles=(0,h.default)(n=e.npcs).apply(n,(0,a.default)((0,p.default)(u).call(u,(function(e){return e.npcs})))).unique(),this._npcTile.tile=this._npcTile.tiles.first(),this._requiredTile.tiles=(0,h.default)(i=e.requiredItems).apply(i,(0,a.default)((0,p.default)(u).call(u,(function(e){return e.requiredItems})))).unique(),this._requiredTile.tile=this._requiredTile.tiles.first(),this._required2Tile.tiles=(0,h.default)(r=e.goalItems).apply(r,(0,a.default)((0,p.default)(u).call(u,(function(e){return e.goalItems})))).unique(),this._required2Tile.tile=this._required2Tile.tiles.first();var s=x.default(e,this._zonePickers.first().zones);(0,v.default)(o=this._zonePickers).call(o,(function(e,t){return e.zone=s[t]}))}},{key:"connectedZones",value:function(e){var t,n,i=this;return(0,p.default)(t=(0,m.default)(n=e.doors).call(n,(function(e){return-1!==e.arg}))).call(t,(function(e){var t,n=e.arg,r=i._gameData.zones[n];return(0,h.default)(t=[r]).call(t,(0,a.default)(i.connectedZones(r)))})).flatten()}},{key:"palette",get:function(){return this._findTile.palette},set:function(e){var t;this._findTile.palette=e,this._npcTile.palette=e,this._requiredTile.palette=e,this._required2Tile.palette=e,this._mainPicker.palette=e,(0,v.default)(t=this._zonePickers).call(t,(function(t){return t.palette=e}))}},{key:"gameData",get:function(){return this._gameData},set:function(e){var t;this._gameData=e,this._mainPicker.zones=e.zones,this._mainPicker.zone=this._mainPicker.filteredZones[0],(0,v.default)(t=this._zonePickers).call(t,(function(t){return t.zones=e.zones})),this.currentZone=this.currentZone}},{key:"configuration",get:function(){var e=this.currentZone.id,t=this._requiredTile.tile?this._requiredTile.tile.id:null,n=this._required2Tile.tile?this._required2Tile.tile.id:null;return{seed:e,zone:e,findItem:this._findTile.tile?this._findTile.tile.id:null,npc:this._npcTile.tile?this._npcTile.tile.id:null,requiredItem1:t,requiredItem2:n,inventory:this._inventory,tags:this._tags,description:this._description,difficulty:this._difficulty,health:this._health}},set:function(e){var t=this._gameData;e.zone>=0&&(this.currentZone=t.zones[e.zone],this._findTile.tile=t.tiles[e.findItem],this._npcTile.tile=t.tiles[e.npc],this._requiredTile.tile=t.tiles[e.requiredItem1],this._required2Tile.tile=t.tiles[e.requiredItem2]),this._inventory=e.inventory,this._tags=e.tags,this._description=e.description,this._difficulty=e.difficulty,this._health=e.health}},{key:"state",get:function(){return this._state},set:function(e){var t;this._state=e,this._mainPicker.state=e.prefixedWith("main-zone"),this.currentZone=this.currentZone,(0,v.default)(t=this._zonePickers).call(t,(function(t,n){return t.state=e.prefixedWith("state-".concat(n))})),this._findTile.state=e.prefixedWith("find-tile"),this._npcTile.state=e.prefixedWith("npc-tile"),this._requiredTile.state=e.prefixedWith("required-tile"),this._required2Tile.state=e.prefixedWith("goal-tile")}}]),n}(y.Component);C.tagName="wf-debug-test-creator-simulation-configuration-builder",t.default=C},87661:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(63789)),o=r(n(76108)),u=r(n(40361)),s=r(n(7583)),l=r(n(18582)),c=r(n(80655)),d=r(n(20497)),f=r(n(75244)),h=r(n(68748)),p=r(n(67093)),v=r(n(42601)),m=r(n(47053)),g=r(n(20778));function y(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,d.default)(this,n)}}(0,h.default)(t,"__esModule",{value:!0}),n(74576);var _=n(5008),k=n(31560),b=n(80485),w=n(7872),S=n(54319),x=n(46930),C=n(28325),T=n(17766),I=n(78256),E=n(20779),B=n(8939),z=n(46e3),W=n(43718),N=n(26193),D=n(8939),A=function(e){(0,c.default)(i,e);var t,n=y(i);function i(){var e;return(0,u.default)(this,i),(e=n.call(this))._state=new k.DiscardingStorage,e._testCase=null,e._configBuilder=WebFun.JSX.render(S.default,null),e._expectationEditor=WebFun.JSX.render(w.ExpectationEditor,null),e._recorder=null,e._input=".",e.title="Test Creator",e.autosaveName="test-creator-window",e.addTitlebarButton(WebFun.JSX.render(_.IconButton,{icon:"download",title:"Download test file",onclick:function(){return e.downloadTest()}})),e.content.style.width="400px",e.content.appendChild(e._configBuilder),e.content.appendChild(WebFun.JSX.render("div",{className:"button-container"},WebFun.JSX.render(_.Button,{label:"Cancel",onclick:function(){return e.close()}}),WebFun.JSX.render(_.Button,{label:"Start",onclick:function(){return e.start()}}))),e}return(0,s.default)(i,[{key:"start",value:(t=(0,o.default)(a.default.mark((function e(){var t,n,i,r,o,u,s,l;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.gameController,e.next=3,n.resetEngine();case 3:if(n.data){e.next=6;break}return e.next=6,n.loadGameData();case 6:i=n.engine,r=n.engine.assets,i.settings.pickupItemsAutomatically=!0,i.settings.skipDialogs=!0,i.settings.skipTransitions=!0,i.settings.difficulty=this.testCase.configuration.difficulty,i.settings.autostartEngine=!1,(o=new W.RecordingInputManager(i.inputManager)).records=N.parse(this.testCase.input),o.engine=i,this._recorder=o,(u=new W.ReplayingInputManager).input=this.testCase.input,u.engine=i,s=function e(){i.metronome.tickDuration=D.DefaultTickDuration,u.removeEventListener(W.ReplayingInputManager.Event.InputEnd,e),u.removeListeners(),i.inputManager=o,o.addListeners(),o.isRecording=!0},u.addEventListener(W.ReplayingInputManager.Event.InputEnd,s),i.inputManager=u,(l=this.buildStory(r)).generateWorld(r,z.Yoda),i.story=l,i.currentWorld=l.world,i.camera.update(1/0),n.jumpStartEngine(l instanceof x.default?l.world.at(4,5).zone:(0,p.default)(r).call(r,T.Zone,(function(e){return e.type===T.Zone.Type.Load}))),(0,v.default)(t=this.testCase.configuration.inventory).call(t,(function(e){return i.inventory.addItem(i.assets.get(T.Tile,e))})),l instanceof x.default||(i.currentWorld=l.dagobah,i.totalPlayTime=0,i.currentPlayStart=new Date),this.testCase.configuration.health&&(i.hero.health=this.testCase.configuration.health),i.hero.location=new k.Point(0,0),i.persistentState.gamesWon=this.testCase.configuration.gamesWon,i.metronome.addEventListener(B.default.Event.AfterTick,this),i.metronome.addEventListener(B.default.Event.BeforeTick,this),this._expectationEditor.engine=i,this.content.textContent="",this.content.appendChild(this._expectationEditor),i.metronome.tickDuration=1,i.metronome._tickCount[0]=0,i.metronome.start();case 42:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"buildStory",value:function(e){var t=this._configBuilder.configuration;return t.zone>=0?this._buildSimulatedStory(e,t):this._buildStory(t)}},{key:"handleEvent",value:function(e){this._expectationEditor.evaluateExpectations()}},{key:"_buildSimulatedStory",value:function(e,t){var n=function(t){return t>0?e.get(T.Tile,t):null},i=function(t){return t>0?e.get(T.Zone,t):null},r=t.zone,a=t.findItem,o=t.npc,u=t.requiredItem1,s=t.requiredItem2;return new x.default(n(a),n(o),n(u),n(s),i(r),C.default(i(r),e.getAll(T.Zone)),e)}},{key:"_buildStory",value:function(e){return new E.Story(e.seed,T.Zone.Planet.fromNumber(e.planet),I.WorldSize.fromNumber(e.size))}},{key:"downloadTest",value:function(){var e,t,n,i=(new b.Serializer).serialize(this._configBuilder.configuration,this._recorder?N.assemble(null===(e=this._recorder)||void 0===e?void 0:e.records).replace(/(\s\.)+$/gi,""):this._input,this._expectationEditor.expectations),r=this._configBuilder.configuration,a=r.zone,o=r.size,u=r.planet,s=r.seed;k.download(i,a>=0?"zone-".concat(a.toHex(3),".wftest"):(0,m.default)(t=(0,m.default)(n="world-".concat(s.toHex(3),"-")).call(n,T.Zone.Planet.fromNumber(u).name.toLowerCase(),"-")).call(t,I.WorldSize.fromNumber(o).name.toLowerCase(),".wftest"))}},{key:"close",value:function(){this.gameController.engine.metronome.removeEventListener(B.default.Event.AfterTick,this),this.gameController.engine.metronome.removeEventListener(B.default.Event.BeforeTick,this),this.gameController.engine.removeEventListener(E.Engine.Event.CurrentZoneChange,this),(0,l.default)((0,f.default)(i.prototype),"close",this).call(this)}},{key:"gameController",get:function(){return this._gameController},set:function(e){this._gameController=e,this._configBuilder.palette=e.palette,this._configBuilder.gameData=e.data}},{key:"testCase",get:function(){var e=(0,g.default)({},this._testCase);return e.expectations=this._expectationEditor.expectations,e.configuration=this._configBuilder.configuration,e.input=this._recorder?N.assemble(this._recorder.records):this._input,e},set:function(e){this._testCase=e,this._configBuilder.configuration=e.configuration,this._expectationEditor.expectations=e.expectations,this._input=e.input}},{key:"state",get:function(){return this._state},set:function(e){this._state=e,this._configBuilder.state=e.prefixedWith("config-builder")}}]),i}(_.AbstractWindow);A.tagName="wf-debug-test-creator-window",t.default=A},28801:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0});var i=n(17766);t.default=function(e){var t=e.type;return t!==i.Zone.Type.Load&&t!==i.Zone.Type.Lose&&t!==i.Zone.Type.Room&&t!==i.Zone.Type.Win&&t!==i.Zone.Type.None}},33627:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244));function d(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(11308);var f=n(88607),h=n(31560),p=n(5008),v=n(78256),m=n(17766),g=function(e){(0,s.default)(n,e);var t=d(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments))._state=new h.DiscardingStorage,e._seed=WebFun.JSX.render(p.Textbox,{onchange:function(){return e._state.store("seed",e._seed.value)}}),e._planet=WebFun.JSX.render(p.Selector,{onchange:function(){return e._state.store("planet",e._planet.value)},options:[{label:m.Zone.Planet.Tatooine.name,value:m.Zone.Planet.Tatooine.rawValue},{label:m.Zone.Planet.Hoth.name,value:m.Zone.Planet.Hoth.rawValue},{label:m.Zone.Planet.Endor.name,value:m.Zone.Planet.Endor.rawValue}]}),e._size=WebFun.JSX.render(p.Selector,{onchange:function(){return e._state.store("size",e._size.value)},options:[{label:v.WorldSize.Small.name,value:v.WorldSize.Small.rawValue},{label:v.WorldSize.Medium.name,value:v.WorldSize.Medium.rawValue},{label:v.WorldSize.Large.name,value:v.WorldSize.Large.rawValue}]}),e._gamesWon=WebFun.JSX.render(p.Textbox,{onchange:function(){return e._state.store("gamesWon",e._gamesWon.value)}}),e}return(0,o.default)(n,[{key:"connectedCallback",value:function(){(0,u.default)((0,c.default)(n.prototype),"connectedCallback",this).call(this),this.append(WebFun.JSX.render("div",null,WebFun.JSX.render("div",null,WebFun.JSX.render("label",null,"Seed"),this._seed),WebFun.JSX.render("div",null,WebFun.JSX.render("label",null,"Planet"),this._planet),WebFun.JSX.render("div",null,WebFun.JSX.render("label",null,"Size"),this._size),WebFun.JSX.render("span",{style:{marginTop:"7px",marginBottom:"7px",borderTop:"1px dashed gray"}}),WebFun.JSX.render("div",null,WebFun.JSX.render("label",null,"Games Won"),this._gamesWon)))}},{key:"configuration",get:function(){var e,t;return{seed:this._seed.value.parseInt(),planet:this._planet.value.parseInt(),size:this._size.value.parseInt(),gamesWon:this._gamesWon.value.parseInt(),inventory:null!==(e=this._inventory)&&void 0!==e?e:[],tags:null!==(t=this._tags)&&void 0!==t?t:[],description:this._description,difficulty:this._difficulty,health:this._health}},set:function(e){"number"==typeof e.seed&&(this._seed.value=e.seed.toHex(4)),"number"==typeof e.planet&&(this._planet.value="".concat(e.planet)),"number"==typeof e.size&&(this._size.value="".concat(e.size)),"number"==typeof e.gamesWon&&(this._gamesWon.value=e.gamesWon.toString(10)),this._inventory=e.inventory,this._tags=e.tags,this._description=e.description,this._difficulty=e.difficulty,this._health=e.health}},{key:"state",get:function(){return this._state},set:function(e){this._state=e,this._seed.value=e.load("seed")||(0).toHex(4),this._planet.value=e.load("planet")||m.Zone.Planet.Tatooine.rawValue,this._size.value=e.load("size")||v.WorldSize.Small.rawValue,this._gamesWon.value=e.load("gamesWon")||"0"}}]),n}(f.Component);g.tagName="wf-debug-test-creator-world-configuration-builder",t.default=g},42169:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244));function d(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(7591);var f=n(5008),h=n(79586),p=function(e){(0,s.default)(n,e);var t=d(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments)).view=WebFun.JSX.render(h.default,null),e}return(0,o.default)(n,[{key:"connectedCallback",value:function(){(0,u.default)((0,c.default)(n.prototype),"connectedCallback",this).call(this),this.appendChild(this.view)}},{key:"disconnectedCallback",value:function(){this.view.remove(),(0,u.default)((0,c.default)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"cloneNode",value:function(e){var t=(0,u.default)((0,c.default)(n.prototype),"cloneNode",this).call(this,e);return t.onclick=this.onclick,t.palette=this.palette,t}},{key:"palette",get:function(){return this.view.palette},set:function(e){this.view.palette=e}},{key:"data",get:function(){return this.view.tile},set:function(e){this.view.tile=e}}]),n}(f.Cell);p.tagName="wf-debug-tile-cell",t.default=p},79586:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(23928)),l=r(n(80655)),c=r(n(20497)),d=r(n(75244));function f(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,c.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(37641);var h=function(e){(0,l.default)(n,e);var t=f(n);function n(){return(0,a.default)(this,n),t.apply(this,arguments)}return(0,o.default)(n,[{key:"tile",get:function(){return(0,u.default)((0,d.default)(n.prototype),"tile",this)},set:function(e){(0,s.default)((0,d.default)(n.prototype),"tile",e,this,!0),this.title=e?e.name:""}}]),n}(n(45010).default);h.tagName="wf-debug-tile-view",t.default=h},78304:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(61822)),a=i(n(40361)),o=i(n(7583)),u=i(n(68748)),s=i(n(35983)),l=i(n(16825)),c=i(n(47053));(0,u.default)(t,"__esModule",{value:!0});var d=function(){function e(){(0,a.default)(this,e),this._cache={}}return(0,o.default)(e,[{key:"prepareListSearch",value:function(e){var t;return(0,s.default)(t=e.split(" ")).call(t,(function(e){return new RegExp(e,"i")}))}},{key:"includeListItem",value:function(e,t){if(!t)return!0;var n=this._stringForZone(t);return(0,l.default)(e).call(e,(function(e){return e.test(n)}))}},{key:"_stringForZone",value:function(e){var t,n,i,a,o,u,l=this._cache[e.id];if(l)return l;var d=(0,c.default)(t=[e.name,"".concat(e.id),e.type.name,e.planet.name,e.hasTeleporter?"teleporter":""]).call(t,(0,r.default)((0,s.default)(n=e.npcs).call(n,(function(e){return e.name}))),(0,r.default)((0,s.default)(i=e.requiredItems).call(i,(function(e){return e.name}))),(0,r.default)((0,s.default)(a=e.providedItems).call(a,(function(e){return e.name}))),(0,r.default)((0,s.default)(o=e.goalItems).call(o,(function(e){return e.name}))),(0,r.default)((0,s.default)(u=e.actions).call(u,(function(e){return e.name}))));return this._cache[e.id]=d.unique().join(" ")}}]),e}();t.default=d},74999:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244));function d(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(47805);var f=n(17766),h=n(5008),p=n(78160),v=function(e){(0,s.default)(n,e);var t=d(n);function n(){var e;return(0,a.default)(this,n),(e=t.apply(this,arguments))._canvas=WebFun.JSX.render("canvas",{className:"pixelated"}),e}return(0,o.default)(n,[{key:"connectedCallback",value:function(){(0,u.default)((0,c.default)(n.prototype),"connectedCallback",this).call(this),this.appendChild(this._canvas),this.draw()}},{key:"draw",value:function(){if(this.palette&&this.data){var e=this._canvas.getContext("2d");e.clearRect(0,0,this.data.size.width*f.Tile.WIDTH,this.data.size.height*f.Tile.HEIGHT);var t=p.drawZoneImageData(this.data,this.palette);e.putImageData(t,0,0)}}},{key:"disconnectedCallback",value:function(){this._canvas.remove(),(0,u.default)((0,c.default)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"cloneNode",value:function(e){var t=(0,u.default)((0,c.default)(n.prototype),"cloneNode",this).call(this,e);return t.palette=this.palette,t.onclick=this.onclick,t}},{key:"data",get:function(){return this._data},set:function(e){this._data=e,e&&(this._canvas.setAttribute("width","".concat(e.size.width*f.Tile.WIDTH)),this._canvas.setAttribute("height","".concat(e.size.height*f.Tile.HEIGHT))),this.isConnected&&this.draw()}},{key:"palette",get:function(){return this._palette},set:function(e){this._palette=e,this.isConnected&&this.draw()}}]),n}(h.Cell);v.tagName="wf-debug-zone-picker-cell",v.observedAttributes=[],t.default=v},35896:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(7583)),u=r(n(18582)),s=r(n(80655)),l=r(n(20497)),c=r(n(75244)),d=r(n(68748)),f=r(n(75356));function h(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}(0,d.default)(t,"__esModule",{value:!0}),t.Events=void 0,n(27004);var p=n(88607),v=n(5008),m=n(78304),g=n(74999);t.Events={ZoneDidChange:"ZoneDidChange"};var y=function(e){(0,s.default)(i,e);var n=h(i);function i(){var e;return(0,a.default)(this,i),(e=n.call(this))._list=WebFun.JSX.render(v.List,{searchDelegate:new m.default,cell:WebFun.JSX.render(g.default,{onclick:function(t){var n=t.currentTarget;return e._cellClicked(n)}})}),e._list.showBar(!0),e}return(0,o.default)(i,[{key:"connectedCallback",value:function(){(0,u.default)((0,c.default)(i.prototype),"connectedCallback",this).call(this),this.appendChild(this._list)}},{key:"_cellClicked",value:function(e){var t,n=this._list.querySelector(g.default.tagName+".active");n&&n.classList.remove("active"),this.zone=e.data,this.changeZone(this.zone,(0,f.default)(t=this._list.querySelectorAll(g.default.tagName)).call(t,e)-1),e.classList.add("active")}},{key:"disconnectedCallback",value:function(){this._list.remove(),(0,u.default)((0,c.default)(i.prototype),"disconnectedCallback",this).call(this)}},{key:"changeZone",value:function(e,n){this.zone=e,this.dispatchEvent(new CustomEvent(t.Events.ZoneDidChange,{detail:{zone:e,index:n},bubbles:!0}))}},{key:"zones",get:function(){return this._zones},set:function(e){this._zones=e,this._list.items=e}},{key:"palette",get:function(){return this.cell.palette},set:function(e){this.cell.palette=e}},{key:"cell",get:function(){return this._list.cell}},{key:"zone",get:function(){return this._zone},set:function(e){this._zone=e}},{key:"state",get:function(){return this._list.state},set:function(e){this._list.state=e.prefixedWith("list")}}]),i}(p.Component);y.Events=t.Events,y.tagName="wf-debug-zone-picker",y.observedAttributes=[],t.default=y},63054:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(40361)),o=r(n(80655)),u=r(n(20497)),s=r(n(75244));function l(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var a=(0,s.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}(0,r(n(68748)).default)(t,"__esModule",{value:!0}),n(24120);var c=function(e){(0,o.default)(n,e);var t=l(n);function n(){return(0,a.default)(this,n),t.apply(this,arguments)}return n}(n(99123).default);c.tagName="wf-debug-zone-view",t.default=c},87212:(e,t,n)=>{"use strict";var i=n(79406),r=n(38468),a=r(n(63789)),o=r(n(76108)),u=r(n(40361)),s=r(n(7583)),l=r(n(80655)),c=r(n(20497)),d=r(n(75244)),f=r(n(68748)),h=r(n(67093)),p=r(n(47053));function v(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.default)(e);if(t){var a=(0,d.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,c.default)(this,n)}}(0,f.default)(t,"__esModule",{value:!0});var m=n(40092),g=n(31560),y=n(63806),_=function(e){(0,l.default)(i,e);var t,n=v(i);function i(){var e;return(0,u.default)(this,i),(e=n.apply(this,arguments))._fps=0,e._tps=0,e._lastFrame=performance.now(),e._lastTick=performance.now(),e}return(0,s.default)(i,[{key:"render",value:function(e){var t;if(e instanceof m.default){if(this.calculateFPS(),this.engine){var n=this.engine.sceneManager._stack,i=(0,h.default)(n).call(n,(function(e){return e instanceof y.ZoneScene}));i&&e.renderText("Zone ".concat(i.zone.id.toHex(3)),new g.Point(200,266))}e.renderText("".concat(this.engine.metronome._tickCount[0]," ticks"),new g.Point(10,246)),e.renderText((0,p.default)(t="".concat(this._fps.toFixed(0)," fps, ")).call(t,this._tps.toFixed(0)," tps"),new g.Point(10,265))}}},{key:"update",value:(t=(0,o.default)(a.default.mark((function e(t){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.calculateTPS();case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"calculateTPS",value:function(){var e=performance.now(),t=1e3/(e-this._lastTick);this._tps=this.smoothen(t,this._tps),this._lastTick=e}},{key:"calculateFPS",value:function(){var e=performance.now(),t=1e3/(e-this._lastFrame);this._fps=this.smoothen(t,this._fps),this._lastFrame=e}},{key:"smoothen",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;return e===1/0?t:e*n+t*(1-n)}}]),i}(y.Scene);t.default=_},61515:(e,t,n)=>{"use strict";var i=n(79406),r=n(92915),a=n(69159),o=n(67986),u=n(13037),s=n(29689),l=n(38468),c=l(n(63789)),d=l(n(68748)),f=l(n(40361)),h=l(n(7583)),p=l(n(18582)),v=l(n(80655)),m=l(n(20497)),g=l(n(75244)),y=l(n(19765)),_=l(n(81581));function k(e,t){var n=void 0!==o&&u(e)||e["@@iterator"];if(!n){if(s(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return b(e,t);var i=r(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return a(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,l=function(){};return{s:l,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,d=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){f=!0,c=e},f:function(){try{d||null==n.return||n.return()}finally{if(f)throw c}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function w(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,g.default)(e);if(t){var a=(0,g.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,m.default)(this,n)}}(0,d.default)(t,"__esModule",{value:!0});var S=n(14017),x=n(85827),C=n(30885),T=n(84485),I=function(e){(0,v.default)(n,e);var t=w(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,f.default)(this,n),(a=t.call(this,e,i,r))._inUse=!1,a._executor=null,a.stopped=!1,a._instructionExecutor=new C.default(i,e),a._conditionChecker=new x.default(r,e),a.delegate=o,a._engine=e,a}return(0,h.default)(n,[{key:"prepareExecution",value:function(e,t){console.assert(!this._inUse,"Executor is already prepared!"),this.willExecute(t),this._executor=this._buildExecutor(e,t)}},{key:"_buildExecutor",value:function(e,t){var n=this;return(0,_.default)(c.default.mark((function i(){var r,a,o,u,s,l,d,f,h,p,v;return c.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:console.assert(!n._inUse,"Executor is already in use!"),n._inUse=!0,r=k(t.actions),i.prev=3,r.s();case 5:if((a=r.n()).done){i.next=92;break}if((o=a.value).enabled){i.next=9;break}return i.abrupt("continue",90);case 9:n.willExecute(o),n._instructionExecutor.action=o;case 11:if(!n.stopped){i.next=16;break}return i.next=14,S.ScriptResult.Wait;case 14:i.next=11;break;case 16:u=k(o.conditions),i.prev=17,u.s();case 19:if((s=u.n()).done){i.next=40;break}l=s.value,n.willExecute(l);case 22:if(!n.stopped){i.next=27;break}return i.next=25,S.ScriptResult.Wait;case 25:i.next=22;break;case 27:return i.next=29,(0,y.default)(n._conditionChecker.check(l,e,t));case 29:d=i.sent,n.didExecute(l,d);case 31:if(!n.stopped){i.next=36;break}return i.next=34,S.ScriptResult.Wait;case 34:i.next=31;break;case 36:if(d){i.next=38;break}return i.abrupt("continue",90);case 38:i.next=19;break;case 40:i.next=45;break;case 42:i.prev=42,i.t0=i.catch(17),u.e(i.t0);case 45:return i.prev=45,u.f(),i.finish(45);case 48:f=k(o.instructions),i.prev=49,f.s();case 51:if((h=f.n()).done){i.next=76;break}p=h.value,n.willExecute(p);case 54:if(!n.stopped){i.next=59;break}return i.next=57,S.ScriptResult.Wait;case 57:i.next=54;break;case 59:return i.next=61,(0,y.default)(n._instructionExecutor.execute(p));case 61:if(i.t1=i.sent,i.t1){i.next=64;break}i.t1=S.Result.Void;case 64:v=i.t1,n.didExecute(p,v);case 66:if(!n.stopped){i.next=71;break}return i.next=69,S.ScriptResult.Wait;case 69:i.next=66;break;case 71:if(v===S.Result.Void){i.next=74;break}return i.next=74,v;case 74:i.next=51;break;case 76:i.next=81;break;case 78:i.prev=78,i.t2=i.catch(49),f.e(i.t2);case 81:return i.prev=81,f.f(),i.finish(81);case 84:n.didExecute(o,null);case 85:if(!n.stopped){i.next=90;break}return i.next=88,S.ScriptResult.Wait;case 88:i.next=85;break;case 90:i.next=5;break;case 92:i.next=97;break;case 94:i.prev=94,i.t3=i.catch(3),r.e(i.t3);case 97:return i.prev=97,r.f(),i.finish(97);case 100:return t.actionsInitialized=!0,e===T.default.PlaceItem&&(n._engine.inputManager.placedTile=null,n._engine.inputManager.placedTileLocation=null),n._inUse=!1,n.didExecute(t,S.ScriptResult.Done),i.abrupt("return",S.ScriptResult.Done);case 105:case"end":return i.stop()}}),i,null,[[3,94,97,100],[17,42,45,48],[49,78,81,84]])})))()}},{key:"willExecute",value:function(e){this.delegate&&this.delegate.executorWillExecute(this,e)}},{key:"didExecute",value:function(e,t){this.delegate&&this.delegate.executorDidExecute(this,e,t)}},{key:"drain",value:function(){(0,p.default)((0,g.default)(n.prototype),"drain",this).call(this),this.delegate&&this.delegate.executorDidDrain(this)}}]),n}(n(17438).default);t.default=I},52871:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0}),t.CompareSectors=t.ComparisonResult=t.ParseExpectation=t.PrepareExpectations=void 0;t.PrepareExpectations=function(e){return e.split("\n")};t.ParseExpectation=function(e,t){if(!e)return{seed:-1};try{return JSON.parse(e)}catch(e){void 0!==t?console.warn("Unable to parse expectation at line ".concat(t,"!")):console.warn("Unable to parse expectation!"),console.log(e)}return{seed:-1}},t.ComparisonResult={Equal:0,Different:1,Similar:2};t.CompareSectors=function(e,n){return(e.zone?e.zone.id:-1)===n.zoneID&&null===e.zoneID?t.ComparisonResult.Equal:(e.zone?e.zone.id:-1)!==n.zoneID||e.zoneType&&e.zoneType.rawValue!==n.zoneType||(e.findItem?e.findItem.id:-1)!==n.findItemID||(e.requiredItem?e.requiredItem.id:-1)!==n.requiredItemID||(e.npc?e.npc.id:-1)!==n.npcID||(e.additionalRequiredItem?e.additionalRequiredItem.id:-1)!==n.additionalRequiredItemID?t.ComparisonResult.Different:t.ComparisonResult.Equal}},91092:(e,t,n)=>{"use strict";var i=n(38468)(n(68748));(0,i.default)(t,"__esModule",{value:!0}),t.PuzzleDependencyGraph=t.SimulatedStory=t.CompareSectors=t.ComparisonResult=t.ParseExpectation=t.PrepareExpectations=t.buildMenu=t.ScriptDebugger=void 0;var r=n(52871);(0,i.default)(t,"CompareSectors",{enumerable:!0,get:function(){return r.CompareSectors}}),(0,i.default)(t,"ComparisonResult",{enumerable:!0,get:function(){return r.ComparisonResult}}),(0,i.default)(t,"ParseExpectation",{enumerable:!0,get:function(){return r.ParseExpectation}}),(0,i.default)(t,"PrepareExpectations",{enumerable:!0,get:function(){return r.PrepareExpectations}});var a=n(13165);t.buildMenu=a.default;var o=n(77975);t.ScriptDebugger=o.default;var u=n(46930);t.SimulatedStory=u.default;var s=n(59923);t.PuzzleDependencyGraph=s.default},71277:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(63789)),a=i(n(76108)),o=i(n(68748)),u=i(n(79302)),s=i(n(5459));(0,o.default)(t,"__esModule",{value:!0});var l=n(88607),c=function(){var e=(0,a.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.default.resolve().then((function(){return n(7872)}));case 2:t=e.sent,l.ComponentRegistry.sharedRegistry.contains((0,s.default)(t).last())||l.ComponentRegistry.sharedRegistry.registerComponents(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t.default=c},38735:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(63789)),a=i(n(94433)),o=i(n(76108)),u=i(n(68748)),s=i(n(79302)),l=i(n(42601));(0,u.default)(t,"__esModule",{value:!0});var c=n(88607);t.default=function(e){return(0,o.default)(r.default.mark((function t(){var i,o,u,d,f,h,p,v=arguments;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=v.length>0&&void 0!==v[0]?v[0]:null){t.next=7;break}return t.next=4,c.FilePicker.Pick();case 4:o=t.sent,u=(0,a.default)(o,1),i=u[0];case 7:if(i){t.next=9;break}return t.abrupt("return");case 9:return t.next=11,i.readAsText();case 11:return d=t.sent,t.next=14,s.default.resolve().then((function(){return n(80485)}));case 14:if(f=t.sent.Parser,(h=f.Parse(i.name,d)).length){t.next=18;break}return t.abrupt("return");case 18:if(e.data){t.next=21;break}return t.next=21,e.loadGameData();case 21:return t.next=23,s.default.resolve().then((function(){return n(7872)}));case 23:p=t.sent.TestCreatorWindow,(0,l.default)(h).call(h,(function(t){var n=document.createElement(p.tagName);n.gameController=e,n.state=localStorage.prefixedWith("simulator"),n.testCase=t,e.window.manager.showWindow(n)}));case 25:case"end":return t.stop()}}),t)})))}},13165:(e,t,n)=>{"use strict";var i=n(92915),r=n(69159),a=n(67986),o=n(13037),u=n(29689),s=n(38468),l=s(n(63789)),c=s(n(76108)),d=s(n(68748)),f=s(n(79302));function h(e,t){var n=void 0!==a&&o(e)||e["@@iterator"];if(!n){if(u(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return p(e,t);var a=i(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return r(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var s=0,l=function(){};return{s:l,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,d=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){f=!0,c=e},f:function(){try{d||null==n.return||n.return()}finally{if(f)throw c}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}(0,d.default)(t,"__esModule",{value:!0});var v=n(88607),m=n(38735),g=n(28061),y=function(e,t,n){return{title:e,callback:function(){n[t]=!n[t]},state:function(){return n[t]?v.MenuItemState.On:v.MenuItemState.Off}}},_=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{title:e,callback:t,beta:n}};t.default=function(e){return f.default.resolve().then((function(){return n(71277)})).then((function(e){return(0,e.default)()})),f.default.resolve().then((function(){return n(9857)})),{title:"Debug",mnemonic:0,submenu:[y("Draw Debug Stats","drawDebugStats",e.settings),y("Draw invisible Hero","drawHeroTile",e.settings),y("Draw Monster State","drawMonsterState",e.settings),y("Reveal World","revealWorld",e.settings),y("Show Hotspots","drawHotspots",e.settings),y("Skip Dialogs","skipDialogs",e.settings),y("Skip Transitions","skipTransitions",e.settings),y("Automatically pick up items","pickupItemsAutomatically",e.settings),v.MenuItemSeparator,_("Clear Settings",(function(){localStorage.clear()})),v.MenuItemSeparator,_("Install Service Workers",(0,c.default)(l.default.mark((function e(){return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.navigator.serviceWorker.register("/service-worker.js").then((function(e){e.onupdatefound=function(){return console.log("[ServiceWorkerClient]","Service worker found an update",e)},console.log("[ServiceWorkerClient]","Service worker registration succeeded.",e)})).catch((function(e){console.log("[ServiceWorkerClient]","Service worker registration failed:",e)}));case 1:case"end":return e.stop()}}),e)})))),_("Uninstall Service Workers",(0,c.default)(l.default.mark((function e(){var t,n,i,r;return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.navigator.serviceWorker.getRegistrations();case 2:t=e.sent,n=h(t),e.prev=4,n.s();case 6:if((i=n.n()).done){e.next=20;break}return r=i.value,e.prev=8,console.log("[ServiceWorkerClient]","Unregistering worker",r),e.next=12,r.unregister();case 12:console.log("[ServiceWorkerClient]","Unregistering worker succeeded"),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(8),console.log("[ServiceWorkerClient]","Unregistering worker failed:",e.t0);case 18:e.next=6;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(4),n.e(e.t1);case 25:return e.prev=25,n.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[4,22,25,28],[8,15]])})))),v.MenuItemSeparator,_("Create Test",(0,c.default)(l.default.mark((function t(){var i,r;return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.default.resolve().then((function(){return n(7872)}));case 2:i=t.sent.TestCreatorWindow,(r=document.createElement(i.tagName)).gameController=e,r.state=localStorage.prefixedWith("simulator"),e.window.manager.showWindow(r);case 7:case"end":return t.stop()}}),t)})))),_("Load Test",m.default(e)),v.MenuItemSeparator,_("Debug Scripts",(0,c.default)(l.default.mark((function t(){var i,r,a;return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.default.resolve().then((function(){return n(77975)}));case 2:i=t.sent.default,r=e.window.manager,(a=new i(r)).engine=e.engine,a.show();case 7:case"end":return t.stop()}}),t)})))),_("Edit Current Data",(0,c.default)(l.default.mark((function t(){return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.default.resolve().then((function(){return n(9857)}));case 2:return t.abrupt("return",t.sent.main(e.data));case 3:case"end":return t.stop()}}),t)}))),!0),_("Edit Game Data...",(0,c.default)(l.default.mark((function e(){return l.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.default.resolve().then((function(){return n(9857)}));case 2:return e.abrupt("return",e.sent.main());case 3:case"end":return e.stop()}}),e)}))),!0),_("Edit Save Game...",(0,c.default)(l.default.mark((function t(){return l.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.default.resolve().then((function(){return n(70945)}));case 2:return t.abrupt("return",t.sent.main(e.window.manager));case 3:case"end":return t.stop()}}),t)}))),!0)]}}},59923:(e,t,n)=>{"use strict";var i=n(92915),r=n(69159),a=n(67986),o=n(13037),u=n(29689),s=n(38468),l=s(n(94433)),c=s(n(61822)),d=s(n(40361)),f=s(n(7583)),h=s(n(68748)),p=s(n(36687)),v=s(n(41870)),m=s(n(68190)),g=s(n(35983)),y=s(n(47053)),_=s(n(75356)),k=s(n(7273)),b=s(n(92915)),w=s(n(31920));function S(e,t){var n=void 0!==a&&o(e)||e["@@iterator"];if(!n){if(u(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return x(e,t);var a=i(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return r(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var s=0,l=function(){};return{s:l,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,d=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){f=!0,c=e},f:function(){try{d||null==n.return||n.return()}finally{if(f)throw c}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}(0,h.default)(t,"__esModule",{value:!0});var C=n(31560),T=n(17766),I=n(17725),E=function(){function e(t){(0,d.default)(this,e),this._solution=null,this.ignoredTypes=new p.default([T.Zone.Type.Empty,T.Zone.Type.Load,T.Zone.Type.Lose,T.Zone.Type.None,T.Zone.Type.Room,T.Zone.Type.Town,T.Zone.Type.Win,T.Zone.Type.TravelEnd,T.Zone.Type.FindUniqueWeapon,null]),this._engine=t}return(0,f.default)(e,[{key:"visitOrder",get:function(){return this._solution||(this._solution=this.solve()),this._solution}},{key:"solve",value:function(){var e,t,n,i,r,a,o,u,s=this,l=this._engine,d=l.world,f=(0,v.default)(e=d.sectors).call(e,(function(e){return e.zoneType===T.Zone.Type.Town})),h=(0,v.default)(t=d.sectors).call(t,(function(e){return e.zoneType===T.Zone.Type.Goal})),k=(0,m.default)(n=(0,g.default)(i=d.sectors).call(i,(function(e,t){return s.ignoredTypes.has(e.zoneType)||e.findItem&&e.findItem.hasAttributes(T.Tile.Attributes.Map)?-1:t}))).call(n,(function(e){return-1!==e})),b=this.precomputeDistances((0,y.default)(r=[f]).call(r,(0,c.default)(k)),d),w=this.precomputeBlocker(k,d),S=this.solveTSP(f,h,new p.default((0,y.default)(a=[null]).call(a,(0,c.default)((0,g.default)(o=l.dagobah.sectors).call(o,(function(e){return e.findItem}))))),new p.default([null]),1/0,[],0,(function(e,t){return b[e][t]}),(function(e){return w[e]}),d,k)[0];return(0,g.default)(u=this._engine.world.sectors).call(u,(function(e,t){return(0,_.default)(S).call(S,t)}))}},{key:"precomputeDistances",value:function(e,t){var n=this,i=e.length,r=(0,k.default)(e).call(e,(function(e,t){return e[t]={},e}),{});return(0,k.default)(e).call(e,(function(e,r,a,o){for(var u=a;u<i;u++)e[r][o[u]]=e[o[u]][r]=n.calculateShortestPath(r,o[u],t).length;return e}),r)}},{key:"solveTSP",value:function(e,t,n,i,r,a,o,u,s,d,f){if(e===t)return[a,o];for(var h=null,v=this.neighbors(d,e,n,i,f,s),m=0,g=v.length;m<g;m++){var k,S=v[m],x=(0,y.default)(k=[]).call(k,(0,c.default)(a),[S]),C=o+u(e,S);if(!(C+f.length-1>=r)){var T=d.sectors[S],I=new p.default(n);I.add(T.findItem),I.add(T.additionalGainItem);var E=new p.default(i);E.add(S);var B=(0,b.default)(f).call(f);(0,w.default)(B).call(B,(0,_.default)(f).call(f,S),1);var z=this.solveTSP(S,t,I,E,r,x,C,u,s,d,B),W=(0,l.default)(z,2);x=W[0],(C=W[1])<r&&(r=C,h=x)}}return[h,r]}},{key:"calculateShortestPath",value:function(e,t,n){var i=this;return C.astar(e,t,(function(e){var t=e%10,r=I.floor(e/10),a=[];t>0&&n.sectors[e-1].zone&&a.push(e-1),t<9&&n.sectors[e+1].zone&&a.push(e+1),r>0&&n.sectors[e-10].zone&&a.push(e-10),r<9&&n.sectors[e+10].zone&&a.push(e+10);for(var o=0,u=a.length;o<u;o++){var s=n.sectors[a[o]];s.zoneType!==T.Zone.Type.TravelStart&&s.zoneType!==T.Zone.Type.TravelEnd||a.push(i._findCounterpart(n,a[o]))}return a}),(function(e,t){return I.abs(e%10-t%10)+I.abs(I.floor(e/10)-I.floor(t/10))}),(function(e){return I.abs(e%10-t%10)+I.abs(I.floor(e/10)-I.floor(t/10))}))}},{key:"neighbors",value:function(e,t,n,i,r,a){return(0,m.default)(r).call(r,(function(t){if(i.has(t))return!1;var r=a(t);if(r&&!i.has(r))return!1;var o=e.sectors[t];return!!n.has(o.requiredItem)&&!!n.has(o.additionalRequiredItem)}))}},{key:"precomputeBlocker",value:function(e,t){var n,i={},r=S(e);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=this.findBlocker(t,a);null!==o&&(i[a]=o)}}catch(e){r.e(e)}finally{r.f()}return i}},{key:"findBlocker",value:function(e,t){var n,i,r,a,o=new C.Point(t%10,I.floor(t/10)),u=null;return(u=null!==(a=u=null!==(r=u=null!==(i=u=null!==(n=u)&&void 0!==n?n:this._findBlocker(e,o,new C.Point(-1,0),T.Zone.Type.BlockadeEast))&&void 0!==i?i:this._findBlocker(e,o,new C.Point(1,0),T.Zone.Type.BlockadeWest))&&void 0!==r?r:this._findBlocker(e,o,new C.Point(0,-1),T.Zone.Type.BlockadeSouth))&&void 0!==a?a:this._findBlocker(e,o,new C.Point(0,1),T.Zone.Type.BlockadeNorth))?this._findCounterpart(e,u):null}},{key:"_findBlocker",value:function(e,t,n,i){for(var r=t.byAdding(n),a=new C.Rectangle(new C.Point(0,0),new C.Size(10,10));;){if(!a.contains(r))return null;var o=e.at(r);if(null===o.zone)return null;if(o.zoneType===i||o.zoneType===T.Zone.Type.TravelEnd)return 10*r.y+r.x;r.add(n)}}},{key:"_findCounterpart",value:function(e,t){var n,i=e.sectors[t];if(i.zoneType!==T.Zone.Type.TravelEnd&&i.zoneType!==T.Zone.Type.TravelStart)return t;var r=i.zoneType===T.Zone.Type.TravelEnd?T.Zone.Type.TravelStart:T.Zone.Type.TravelEnd;return(0,v.default)(n=e.sectors).call(n,(function(e){return e.zoneType===r&&e.requiredItem===i.requiredItem}))}}]),e}();t.default=E},81299:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0});var i=n(31560),r=n(17766);t.default=function(e,t,n){e.fillRect instanceof Function&&e.fillRect((t.x+n.x)*r.Tile.WIDTH,(t.y+n.y)*r.Tile.HEIGHT,r.Tile.WIDTH,r.Tile.HEIGHT,i.rgba(0,0,255,.3))}},28667:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(68748)),a=i(n(42601));(0,r.default)(t,"__esModule",{value:!0});var o=n(17766),u=n(31560),s=n(40092);t.default=function(e,t,n){if(e.fillRect instanceof Function){var i=0,r=new u.Point(-1,-1);(0,a.default)(t).call(t,(function(t){if(e.fillRect((t.x+n.x)*o.Tile.WIDTH,(t.y+n.y)*o.Tile.HEIGHT,o.Tile.WIDTH,o.Tile.HEIGHT,t.enabled?u.rgba(0,255,0,.3):u.rgba(255,0,0,.3)),e instanceof s.default){t.location.isEqualTo(r)||(i=0),r=t.location;var a=new u.Point((t.x+n.x)*o.Tile.WIDTH,10*i+(t.y+n.y)*o.Tile.HEIGHT);e.renderText(function(e){switch(e){case o.Hotspot.Type.DropQuestItem:return"quest";case o.Hotspot.Type.DropUniqueWeapon:return"dpuni";case o.Hotspot.Type.DropMap:return"dpmap";case o.Hotspot.Type.DropItem:return"dpitm";case o.Hotspot.Type.DropWeapon:return"dpwpn";case o.Hotspot.Type.SpawnLocation:return"spawn";case o.Hotspot.Type.NPC:return"npc";case o.Hotspot.Type.Lock:return"lock";case o.Hotspot.Type.Teleporter:return"telep";case o.Hotspot.Type.Unused:return"none";case o.Hotspot.Type.DoorIn:return"doorin";case o.Hotspot.Type.DoorOut:return"dooout";case o.Hotspot.Type.VehicleTo:return"vehto";case o.Hotspot.Type.VehicleBack:return"vehba";case o.Hotspot.Type.ShipToPlanet:return"shipto";case o.Hotspot.Type.ShipFromPlanet:return"shipfr"}}(t.type),a,{font:'10px "Anonymous Pro", monospace',fillStyle:"rgba(255, 255, 255, 0.6)",shadowColor:"rgba(0,0,0,0)",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0}),i++}}))}}},47128:(e,t,n)=>{"use strict";var i=n(38468),r=i(n(68748)),a=i(n(42601));(0,r.default)(t,"__esModule",{value:!0});var o=n(17766),u=n(31560),s=n(17725);t.default=function(e,t,n){e.fillRect instanceof Function&&(0,a.default)(t).call(t,(function(t){if(t.alive){var i=new u.Rectangle(t.position.byAdding(n).byScalingBy(o.Tile.WIDTH).byAdding(0,o.Tile.HEIGHT-12),new u.Size(o.Tile.WIDTH,12)).inset(4,4);e.fillRect(i.origin.x,i.origin.y,i.size.width,i.size.height,u.rgba(0,0,0,.2));var r=1-t.damageTaken/t.face.health,a=u.rgba(0,255,0,.6);r<.5&&(a=u.rgba(255,255,0,.6)),r<1/3&&(a=u.rgba(255,0,0,.6)),i.size.width=s.round(i.size.width*r),e.fillRect(i.origin.x,i.origin.y,i.size.width,i.size.height,a)}}))}},5318:(e,t,n)=>{"use strict";(0,n(38468)(n(68748)).default)(t,"__esModule",{value:!0}),t.highlightHotspots=t.highlightMonsters=t.highlightHero=void 0;var i=n(81299);t.highlightHero=i.default;var r=n(28667);t.highlightHotspots=r.default;var a=n(47128);t.highlightMonsters=a.default},77975:(e,t,n)=>{"use strict";var i,r=n(38468),a=r(n(94433)),o=r(n(40361)),u=r(n(7583)),s=r(n(57362)),l=r(n(68748)),c=r(n(42601)),d=r(n(6978)),f=r(n(35983)),h=r(n(47053)),p=r(n(68190)),v=r(n(75356));(0,l.default)(t,"__esModule",{value:!0}),n(67186);var m=n(17766),g=n(7872),y=n(47590),_=n(61515),k=n(20779),b=n(35288),w=n(3185),S=n(22921),x=n(26710),C=n(40136),T=n(31560),I=n(17438),E=n(5008),B=(i={},(0,s.default)(i,b.InstructionsByName.SetSectorCounter.Opcode,!0),(0,s.default)(i,b.InstructionsByName.AddToSectorCounter.Opcode,!0),(0,s.default)(i,b.InstructionsByName.AddToCounter.Opcode,!0),(0,s.default)(i,b.InstructionsByName.SetCounter.Opcode,!0),(0,s.default)(i,b.InstructionsByName.RollDice.Opcode,!0),(0,s.default)(i,b.InstructionsByName.SetRandom.Opcode,!0),i),z=function(){function e(t){var n=this;(0,o.default)(this,e),this._isActive=!1,this._handlers={zoneChange:function(){n._updateZoneState(),n._rebuildActionList()}},this._currentZone=null,this._currentAction=null,this._variableMap={},this._windowManager=t,this._breakpointStore=new w.default,this._breakpointStore.backend=localStorage.prefixedWith("debug"),this._window=WebFun.JSX.render(E.Window,{className:"script-debugger-window",title:"Script Debugger",origin:new T.Point(10,10),autosaveName:"script-debugger"}),this._window&&this._window.content&&(this._window.content.style.minWidth="200px",this._window.content.appendChild(WebFun.JSX.render(S.default,{onstep:function(){return n.stepOnce()},ontogglepause:function(){return n.togglePause()}})),this._window.content.appendChild(this._buildZoneState()),this._actionList=WebFun.JSX.render(x.default,{className:"action-list"}),this._window.content.appendChild(this._actionList))}return(0,u.default)(e,[{key:"engine",get:function(){return this._engine},set:function(e){var t=this._isActive;this._engine&&this._teardownDebugger(),this._engine=e,this._engine&&t&&this._setupDebugger()}},{key:"show",value:function(){var e=this;this._setupDebugger(),this._window.onclose=function(){return e._teardownDebugger()},this._windowManager.showWindow(this._window)}},{key:"_setupDebugger",value:function(){this._isActive||this._engine&&(this._engine.spu=new _.default(this._engine,b.InstructionImplementations,y.ConditionImplementations,this),this._engine.addEventListener(k.EngineEvents.CurrentZoneChange,this._handlers.zoneChange),this._isActive=!0,this._engine.settings.debuggerActive=!0)}},{key:"_teardownDebugger",value:function(){this._isActive&&(this._engine.settings.debuggerActive=!1,this._engine.removeEventListener(k.EngineEvents.CurrentZoneChange,this._handlers.zoneChange),this._engine.spu=new I.default(this._engine,b.InstructionImplementations,y.ConditionImplementations),this._isActive=!1)}},{key:"_rebuildActionList",value:function(){var e,t=this;this._rebuildVariableMap(),this._actionList.textContent="",(0,c.default)(e=this._engine.currentZone.actions).call(e,(function(e,n){var i=WebFun.JSX.render(g.Action,{engine:t._engine,breakpointStore:t._breakpointStore,zone:t._engine.currentZone,index:n,variableMap:t._variableMap,action:e});i.evaluateConditions(),t._actionList.appendChild(i)})),this._actionList.firstElementChild&&this._actionList.firstElementChild.scrollIntoViewIfNeeded()}},{key:"_rebuildVariableMap",value:function(){var e,t,n,i=this,r=0;this._variableMap={},(0,c.default)(e=(0,d.default)(t=(0,f.default)(n=this._engine.currentZone.actions).call(n,(function(e){var t,n,i,r,a;return(0,h.default)(t=(0,f.default)(n=(0,p.default)(i=e.conditions).call(i,(function(e){return e.opcode===y.ConditionsByName.IsVariable.Opcode}))).call(n,(function(e){return[e.arguments[1],e.arguments[2],e.arguments[3]]}))).call(t,(0,f.default)(r=(0,p.default)(a=e.instructions).call(a,(function(e){return e.opcode===b.InstructionsByName.SetVariable.Opcode}))).call(r,(function(e){return[e.arguments[0],e.arguments[1],e.arguments[2]]})))})).flatten()).call(t)).call(e,(function(e){var t,n,o=(0,a.default)(e,3),u=o[0],s=o[1],l=o[2],c=(0,h.default)(t=(0,h.default)(n="".concat(u.toString(),"x")).call(n,s.toString(),"x")).call(t,l.toString());void 0===i._variableMap[c]&&(i._variableMap[c]=r++)}))}},{key:"stepOnce",value:function(){this._breakAfter=!0;var e=this._engine.spu;this.continueExecution(e)}},{key:"togglePause",value:function(){var e=this._engine.spu;e.stopped?this.continueExecution(e):this.stopExecution(e)}},{key:"_reflectExecutorState",value:function(){var e=this._engine.spu,t=this._window.content.querySelector(S.default.tagName);e.stopped?t.removeAttribute("running"):t.setAttribute("running","")}},{key:"_reflectExecutorPosition",value:function(e){var t,n=this._actionList.querySelector("".concat(g.Action.tagName,"[current]"));n&&n.removeAttribute("current");var i=this._actionList.querySelector((0,h.default)(t="".concat(g.Instruction.tagName,"[current],")).call(t,g.Condition.tagName,"[current]"));if(i&&i.removeAttribute("current"),e){var r=e.id.substr(1).split(":"),o=(0,a.default)(r,4),u=o[1],s=o[2],l=void 0===s?null:s,c=o[3],d=void 0===c?null:c,f=this._actionList.querySelectorAll(g.Action.tagName)[+u];if(f&&(f.setAttribute("current",""),l)){var p=f.querySelectorAll("c"===l?g.Condition.tagName:g.Instruction.tagName)[+d];p&&p.setAttribute("current","")}}}},{key:"executorWillExecute",value:function(e,t){if(t instanceof m.Zone)return this._currentZone=t,void(this._currentAction=null);var n,i;(t instanceof m.Action&&(this._currentAction=t,t.zone!==this._currentZone&&console.warn("action does not belong to current zone!"),this._currentAction.zone!==this.engine.currentZone&&(console.warn("Engine thinks we're on a different zone!"),console.log("Action is on ",this._currentAction.zone.id,"engine thinks it is zone",this.engine.currentZone.id,"debugger thinks is",this._currentZone.id))),"isCondition"in t)&&(this._currentAction.zone!==this._currentZone&&console.warn("action does not belong to current zone!"),-1===(0,v.default)(n=this._currentAction.conditions).call(n,t)&&console.warn("Condition not found in current action!"));"isInstruction"in t&&(this._currentAction.zone!==this._currentZone&&console.warn("action does not belong to current zone!"),-1===(0,v.default)(i=this._currentAction.instructions).call(i,t)&&console.warn("Instruction not found in current action!"));var r=this.buildBreakpoint(t);this._reflectExecutorPosition(r),r&&this._breakpointStore.hasBreakpoint(r.id)&&(console.log("stopping because of breakpoint",r.id),this.stopExecution(e))}},{key:"buildBreakpoint",value:function(e){var t,n,i=null;(e instanceof m.Action&&(this._currentAction=e,i=new C.LocationBreakpoint(e.zone.id,e.id)),"isCondition"in e)&&(i=new C.LocationBreakpoint(this._currentZone.id,this._currentAction.id,"c",(0,v.default)(t=this._currentAction.conditions).call(t,e)));"isInstruction"in e&&(i=new C.LocationBreakpoint(this._currentZone.id,this._currentAction.id,"i",(0,v.default)(n=this._currentAction.instructions).call(n,e)));return i}},{key:"executorDidExecute",value:function(e,t,n){this._breakAfter&&(this.stopExecution(e),this._breakAfter=!1),t instanceof m.Zone?this._currentZone=null:t instanceof m.Action||"isCondition"in t||"isInstruction"in t&&B[t.opcode]&&this._updateZoneState()}},{key:"executorDidDrain",value:function(e){this._currentZone=null,this._currentAction=null}},{key:"continueExecution",value:function(e){e.stopped=!1,this._reflectExecutorState()}},{key:"stopExecution",value:function(e){var t;e.stopped=!0,(0,c.default)(t=this._actionList.querySelectorAll(g.Action.tagName)).call(t,(function(e){return e.evaluateConditions()})),this._reflectExecutorState(),this._scrollToCurrentInstruction(),this._updateZoneState()}},{key:"_scrollToCurrentInstruction",value:function(){var e,t=this._actionList.querySelector("".concat(g.Action.tagName,"[current]"));t&&(t.querySelector((0,h.default)(e="".concat(g.Condition.tagName,"[current],")).call(e,g.Instruction.tagName,"[current]"))||t).scrollIntoViewIfNeeded()}},{key:"_updateZoneState",value:function(){this._window.content.querySelector(".zone-state").replaceWith(this._buildZoneState())}},{key:"_buildZoneState",value:function(){var e=this.engine&&this.engine.currentZone,t="",n="",i="";return e&&(t=e.counter.toString(),n=e.random.toString(),i=e.sectorCounter.toString()),WebFun.JSX.render(x.default,{className:"zone-state"},WebFun.JSX.render("label",null,"Counter:"),WebFun.JSX.render("span",null,t),WebFun.JSX.render("label",null,"Random:"),WebFun.JSX.render("span",null,n),WebFun.JSX.render("label",null,"Sector counter:"),WebFun.JSX.render("span",null,i))}}]),e}();t.default=z},46930:(e,t,n)=>{"use strict";var i=n(79406),r=n(92915),a=n(69159),o=n(67986),u=n(13037),s=n(29689),l=n(38468),c=l(n(40361)),d=l(n(7583)),f=l(n(80655)),h=l(n(20497)),p=l(n(75244));function v(e,t){var n=void 0!==o&&u(e)||e["@@iterator"];if(!n){if(s(e)||(n=function(e,t){var n;if(!e)return;if("string"==typeof e)return m(e,t);var i=r(n=Object.prototype.toString.call(e)).call(n,8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return a(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,l=function(){};return{s:l,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,d=!0,f=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return d=e.done,e},e:function(e){f=!0,c=e},f:function(){try{d||null==n.return||n.return()}finally{if(f)throw c}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function g(e){var t=function(){if("undefined"==typeof Reflect||!i)return!1;if(i.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(i(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,p.default)(e);if(t){var a=(0,p.default)(this).constructor;n=i(r,arguments,a)}else n=r.apply(this,arguments);return(0,h.default)(this,n)}}(0,l(n(68748)).default)(t,"__esModule",{value:!0});var y=n(20779),_=n(17766),k=n(23754),b=n(78256),w=n(31560),S=n(83297),x=function(e){(0,f.default)(n,e);var t=g(n);function n(e,i,r,a,o,u,s){var l;return(0,c.default)(this,n),l=t.call(this,0,o.planet,b.WorldSize.Small),w.srand(0),l.assets=s,l._buildWorld(o,u,s),l._buildPuzzle(o,e,i,r,a),l._initializeZone(o,e,i,r,a),l}return(0,d.default)(n,[{key:"_buildPuzzle",value:function(e,t,n,i,r){var a=this._world.at(4,4);a.findItem=t,a.npc=n,a.requiredItem=i,a.additionalRequiredItem=r}},{key:"_buildWorld",value:function(e,t,n){var i=new k.default(n);i.at(4,4).zone=e,i.at(3,3).zone=t[0],i.at(4,3).zone=t[1],i.at(5,3).zone=t[2],i.at(3,4).zone=t[3],i.at(5,4).zone=t[4],i.at(3,5).zone=t[5],i.at(4,5).zone=t[6],i.at(5,5).zone=t[7],this._world=i,this._dagobah=new k.default(n)}},{key:"_initializeZone",value:function(e,t,n,i,r){switch(e.type){case _.Zone.Type.BlockadeNorth:case _.Zone.Type.BlockadeSouth:case _.Zone.Type.BlockadeEast:case _.Zone.Type.BlockadeWest:case _.Zone.Type.TravelStart:case _.Zone.Type.TravelEnd:break;case _.Zone.Type.Goal:case _.Zone.Type.Trade:case _.Zone.Type.Use:break;case _.Zone.Type.Find:case _.Zone.Type.FindUniqueWeapon:var a,o=(c=t).hasAttributes(_.Tile.Attributes.Weapon)?_.Hotspot.Type.DropUniqueWeapon:c.hasAttributes(_.Tile.Attributes.Map)?_.Hotspot.Type.DropMap:c.hasAttributes(_.Tile.Attributes.Item)?_.Hotspot.Type.DropQuestItem:void 0,u=v(S.default(e,this.assets));try{for(u.s();!(a=u.n()).done;){var s=a.value.hotspots.withType(o);if(s.length){var l=s[w.randmod(s.length)];l.enabled=!0,l.arg=t.id;break}}}catch(e){u.e(e)}finally{u.f()}break;case _.Zone.Type.Town:case _.Zone.Type.Empty:}var c}},{key:"generateWorld",value:function(e){for(var t,n=new k.default(e),i=function(t){return t&&e.get(_.Tile,t.id)},r=0;r<k.default.Size.height;r++)for(var a=0;a<k.default.Size.width;a++){var o=this._world.at(a,r),u=n.at(a,r);u.zone=(t=o.zone)&&e.get(_.Zone,t.id),u.zoneType=o.zoneType,u.puzzleIndex=o.puzzleIndex,u.requiredItem=i(o.requiredItem),u.additionalRequiredItem=i(o.additionalRequiredItem),u.npc=i(o.npc),u.findItem=i(o.findItem)}this._world=n,this._dagobah=n,this.goal=e.get(_.Puzzle,0)}},{key:"world",get:function(){return this._world},set:function(e){this._world=e}}]),n}(y.Story);t.default=x},65308:(e,t,n)=>{"use strict";n.r(t)},41370:(e,t,n)=>{"use strict";n.r(t)},18181:(e,t,n)=>{"use strict";n.r(t)},27101:(e,t,n)=>{"use strict";n.r(t)},40943:(e,t,n)=>{"use strict";n.r(t)},31771:(e,t,n)=>{"use strict";n.r(t)},4397:(e,t,n)=>{"use strict";n.r(t)},89566:(e,t,n)=>{"use strict";n.r(t)},51839:(e,t,n)=>{"use strict";n.r(t)},17602:(e,t,n)=>{"use strict";n.r(t)},3347:(e,t,n)=>{"use strict";n.r(t)},74576:(e,t,n)=>{"use strict";n.r(t)},11308:(e,t,n)=>{"use strict";n.r(t)},7591:(e,t,n)=>{"use strict";n.r(t)},37641:(e,t,n)=>{"use strict";n.r(t)},47805:(e,t,n)=>{"use strict";n.r(t)},27004:(e,t,n)=>{"use strict";n.r(t)},24120:(e,t,n)=>{"use strict";n.r(t)},67186:(e,t,n)=>{"use strict";n.r(t)}}]);